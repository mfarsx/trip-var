25b1d4a718af905ffe273cafb3569ad3
/* eslint-disable no-param-reassign, class-methods-use-this, space-before-function-paren, no-unused-vars */
const userService = require('../services/user.service');
const BaseController = require('./base.controller');
const {
  asyncHandler
} = require('../utils/asyncHandler');
class AuthController extends BaseController {
  // Register new user
  register = asyncHandler(async (req, res, next) => {
    const result = await userService.register(req.body);
    this.sendSuccess(res, result, 'User registered successfully', 201);
  });

  // Login user
  login = asyncHandler(async (req, res, next) => {
    const result = await userService.login(req.body);
    this.sendSuccess(res, result, 'Login successful');
  });

  // Get current user profile
  getProfile = asyncHandler(async (req, res, next) => {
    const user = await userService.getProfile(req.user.id);
    this.sendSuccess(res, {
      user
    }, 'Profile retrieved successfully');
  });

  // Update user profile
  updateProfile = asyncHandler(async (req, res, next) => {
    const updatedUser = await userService.updateProfile(req.user.id, req.body);
    this.sendSuccess(res, {
      user: updatedUser
    }, 'Profile updated successfully');
  });

  // Update password
  updatePassword = asyncHandler(async (req, res, next) => {
    const result = await userService.updatePassword(req.user.id, req.body);
    this.sendSuccess(res, result, 'Password updated successfully');
  });

  // Delete user account
  deleteAccount = asyncHandler(async (req, res, next) => {
    await userService.deleteAccount(req.user.id);
    this.sendSuccess(res, null, 'Account deleted successfully', 204);
  });

  // Get all users
  getAllUsers = asyncHandler(async (req, res, next) => {
    const {
      page,
      limit
    } = this.getPaginationParams(req.query);
    const result = await userService.getAllUsers({
      page,
      limit
    });
    this.sendPaginated(res, result.users, page, limit, result.pagination.total);
  });

  // Logout user
  logout = asyncHandler(async (req, res, next) => {
    // Clear the token from the client side
    this.sendSuccess(res, null, 'Logged out successfully');
  });

  // Toggle favorite destination
  toggleFavorite = asyncHandler(async (req, res, next) => {
    this.validateRequestParams(req.params, ['destinationId']);
    const result = await userService.toggleFavorite(req.user.id, req.params.destinationId);
    this.sendSuccess(res, result, `Destination ${result.isFavorite ? 'added to' : 'removed from'} favorites`);
  });

  // Get user's favorite destinations
  getFavorites = asyncHandler(async (req, res, next) => {
    const favorites = await userService.getFavorites(req.user.id);
    this.sendSuccess(res, {
      favorites
    }, 'Favorites retrieved successfully');
  });
}
module.exports = new AuthController();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ1c2VyU2VydmljZSIsInJlcXVpcmUiLCJCYXNlQ29udHJvbGxlciIsImFzeW5jSGFuZGxlciIsIkF1dGhDb250cm9sbGVyIiwicmVnaXN0ZXIiLCJyZXEiLCJyZXMiLCJuZXh0IiwicmVzdWx0IiwiYm9keSIsInNlbmRTdWNjZXNzIiwibG9naW4iLCJnZXRQcm9maWxlIiwidXNlciIsImlkIiwidXBkYXRlUHJvZmlsZSIsInVwZGF0ZWRVc2VyIiwidXBkYXRlUGFzc3dvcmQiLCJkZWxldGVBY2NvdW50IiwiZ2V0QWxsVXNlcnMiLCJwYWdlIiwibGltaXQiLCJnZXRQYWdpbmF0aW9uUGFyYW1zIiwicXVlcnkiLCJzZW5kUGFnaW5hdGVkIiwidXNlcnMiLCJwYWdpbmF0aW9uIiwidG90YWwiLCJsb2dvdXQiLCJ0b2dnbGVGYXZvcml0ZSIsInZhbGlkYXRlUmVxdWVzdFBhcmFtcyIsInBhcmFtcyIsImRlc3RpbmF0aW9uSWQiLCJpc0Zhdm9yaXRlIiwiZ2V0RmF2b3JpdGVzIiwiZmF2b3JpdGVzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImF1dGguY29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBuby1wYXJhbS1yZWFzc2lnbiwgY2xhc3MtbWV0aG9kcy11c2UtdGhpcywgc3BhY2UtYmVmb3JlLWZ1bmN0aW9uLXBhcmVuLCBuby11bnVzZWQtdmFycyAqL1xuY29uc3QgdXNlclNlcnZpY2UgPSByZXF1aXJlKCcuLi9zZXJ2aWNlcy91c2VyLnNlcnZpY2UnKTtcbmNvbnN0IEJhc2VDb250cm9sbGVyID0gcmVxdWlyZSgnLi9iYXNlLmNvbnRyb2xsZXInKTtcbmNvbnN0IHsgYXN5bmNIYW5kbGVyIH0gPSByZXF1aXJlKCcuLi91dGlscy9hc3luY0hhbmRsZXInKTtcblxuY2xhc3MgQXV0aENvbnRyb2xsZXIgZXh0ZW5kcyBCYXNlQ29udHJvbGxlciB7XG4gIC8vIFJlZ2lzdGVyIG5ldyB1c2VyXG4gIHJlZ2lzdGVyID0gYXN5bmNIYW5kbGVyKGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVzZXJTZXJ2aWNlLnJlZ2lzdGVyKHJlcS5ib2R5KTtcbiAgICB0aGlzLnNlbmRTdWNjZXNzKHJlcywgcmVzdWx0LCAnVXNlciByZWdpc3RlcmVkIHN1Y2Nlc3NmdWxseScsIDIwMSk7XG4gIH0pO1xuXG4gIC8vIExvZ2luIHVzZXJcbiAgbG9naW4gPSBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlclNlcnZpY2UubG9naW4ocmVxLmJvZHkpO1xuICAgIHRoaXMuc2VuZFN1Y2Nlc3MocmVzLCByZXN1bHQsICdMb2dpbiBzdWNjZXNzZnVsJyk7XG4gIH0pO1xuXG4gIC8vIEdldCBjdXJyZW50IHVzZXIgcHJvZmlsZVxuICBnZXRQcm9maWxlID0gYXN5bmNIYW5kbGVyKGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB1c2VyU2VydmljZS5nZXRQcm9maWxlKHJlcS51c2VyLmlkKTtcbiAgICB0aGlzLnNlbmRTdWNjZXNzKHJlcywgeyB1c2VyIH0sICdQcm9maWxlIHJldHJpZXZlZCBzdWNjZXNzZnVsbHknKTtcbiAgfSk7XG5cbiAgLy8gVXBkYXRlIHVzZXIgcHJvZmlsZVxuICB1cGRhdGVQcm9maWxlID0gYXN5bmNIYW5kbGVyKGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgIGNvbnN0IHVwZGF0ZWRVc2VyID0gYXdhaXQgdXNlclNlcnZpY2UudXBkYXRlUHJvZmlsZShyZXEudXNlci5pZCwgcmVxLmJvZHkpO1xuICAgIHRoaXMuc2VuZFN1Y2Nlc3MocmVzLCB7IHVzZXI6IHVwZGF0ZWRVc2VyIH0sICdQcm9maWxlIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gIH0pO1xuXG4gIC8vIFVwZGF0ZSBwYXNzd29yZFxuICB1cGRhdGVQYXNzd29yZCA9IGFzeW5jSGFuZGxlcihhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyU2VydmljZS51cGRhdGVQYXNzd29yZChyZXEudXNlci5pZCwgcmVxLmJvZHkpO1xuICAgIHRoaXMuc2VuZFN1Y2Nlc3MocmVzLCByZXN1bHQsICdQYXNzd29yZCB1cGRhdGVkIHN1Y2Nlc3NmdWxseScpO1xuICB9KTtcblxuICAvLyBEZWxldGUgdXNlciBhY2NvdW50XG4gIGRlbGV0ZUFjY291bnQgPSBhc3luY0hhbmRsZXIoYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgYXdhaXQgdXNlclNlcnZpY2UuZGVsZXRlQWNjb3VudChyZXEudXNlci5pZCk7XG4gICAgdGhpcy5zZW5kU3VjY2VzcyhyZXMsIG51bGwsICdBY2NvdW50IGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JywgMjA0KTtcbiAgfSk7XG5cbiAgLy8gR2V0IGFsbCB1c2Vyc1xuICBnZXRBbGxVc2VycyA9IGFzeW5jSGFuZGxlcihhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICBjb25zdCB7IHBhZ2UsIGxpbWl0IH0gPSB0aGlzLmdldFBhZ2luYXRpb25QYXJhbXMocmVxLnF1ZXJ5KTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyU2VydmljZS5nZXRBbGxVc2Vycyh7IHBhZ2UsIGxpbWl0IH0pO1xuICAgIHRoaXMuc2VuZFBhZ2luYXRlZChyZXMsIHJlc3VsdC51c2VycywgcGFnZSwgbGltaXQsIHJlc3VsdC5wYWdpbmF0aW9uLnRvdGFsKTtcbiAgfSk7XG5cbiAgLy8gTG9nb3V0IHVzZXJcbiAgbG9nb3V0ID0gYXN5bmNIYW5kbGVyKGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgIC8vIENsZWFyIHRoZSB0b2tlbiBmcm9tIHRoZSBjbGllbnQgc2lkZVxuICAgIHRoaXMuc2VuZFN1Y2Nlc3MocmVzLCBudWxsLCAnTG9nZ2VkIG91dCBzdWNjZXNzZnVsbHknKTtcbiAgfSk7XG5cbiAgLy8gVG9nZ2xlIGZhdm9yaXRlIGRlc3RpbmF0aW9uXG4gIHRvZ2dsZUZhdm9yaXRlID0gYXN5bmNIYW5kbGVyKGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgIHRoaXMudmFsaWRhdGVSZXF1ZXN0UGFyYW1zKHJlcS5wYXJhbXMsIFsnZGVzdGluYXRpb25JZCddKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1c2VyU2VydmljZS50b2dnbGVGYXZvcml0ZShyZXEudXNlci5pZCwgcmVxLnBhcmFtcy5kZXN0aW5hdGlvbklkKTtcbiAgICB0aGlzLnNlbmRTdWNjZXNzKHJlcywgcmVzdWx0LCBgRGVzdGluYXRpb24gJHtyZXN1bHQuaXNGYXZvcml0ZSA/ICdhZGRlZCB0bycgOiAncmVtb3ZlZCBmcm9tJ30gZmF2b3JpdGVzYCk7XG4gIH0pO1xuXG4gIC8vIEdldCB1c2VyJ3MgZmF2b3JpdGUgZGVzdGluYXRpb25zXG4gIGdldEZhdm9yaXRlcyA9IGFzeW5jSGFuZGxlcihhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICBjb25zdCBmYXZvcml0ZXMgPSBhd2FpdCB1c2VyU2VydmljZS5nZXRGYXZvcml0ZXMocmVxLnVzZXIuaWQpO1xuICAgIHRoaXMuc2VuZFN1Y2Nlc3MocmVzLCB7IGZhdm9yaXRlcyB9LCAnRmF2b3JpdGVzIHJldHJpZXZlZCBzdWNjZXNzZnVsbHknKTtcbiAgfSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gbmV3IEF1dGhDb250cm9sbGVyKCk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0EsTUFBTUEsV0FBVyxHQUFHQyxPQUFPLENBQUMsMEJBQTBCLENBQUM7QUFDdkQsTUFBTUMsY0FBYyxHQUFHRCxPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDbkQsTUFBTTtFQUFFRTtBQUFhLENBQUMsR0FBR0YsT0FBTyxDQUFDLHVCQUF1QixDQUFDO0FBRXpELE1BQU1HLGNBQWMsU0FBU0YsY0FBYyxDQUFDO0VBQzFDO0VBQ0FHLFFBQVEsR0FB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