{"version":3,"names":["request","require","app","setupTestEnvironment","cleanupTestEnvironment","expectSuccessResponse","describe","beforeAll","afterAll","it","response","get","expect","body","toHaveProperty","status","toBe","service","version","toBeDefined","environment","services","uptime","startTime","Date","now","endTime","responseTime","toBeLessThan","promises","Array","fill","map","responses","Promise","all","forEach"],"sources":["health.test.js"],"sourcesContent":["const request = require('supertest');\nconst app = require('./app.test');\nconst {\n  setupTestEnvironment,\n  cleanupTestEnvironment,\n  expectSuccessResponse\n} = require('./setup');\n\ndescribe('Health Check API', () => {\n  beforeAll(async () => {\n    await setupTestEnvironment();\n  });\n\n  afterAll(async () => {\n    await cleanupTestEnvironment();\n  });\n\n  describe('GET /health', () => {\n    it('should return health status successfully', async () => {\n      const response = await request(app)\n        .get('/health')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('status');\n      expect(response.body).toHaveProperty('timestamp');\n      expect(response.body).toHaveProperty('uptime');\n      expect(response.body).toHaveProperty('environment');\n      expect(response.body.status).toBe('ok');\n    });\n\n    it('should include basic service information', async () => {\n      const response = await request(app)\n        .get('/health')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('service');\n      expect(response.body).toHaveProperty('version');\n      expect(response.body.service).toBe('tripvar-server');\n      expect(response.body.version).toBeDefined();\n    });\n\n    it('should check database status via dedicated endpoint', async () => {\n      const response = await request(app)\n        .get('/health/db')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('status');\n      expect(response.body).toHaveProperty('database');\n    });\n\n    it('should check Redis status via dedicated endpoint', async () => {\n      const response = await request(app)\n        .get('/health/redis')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('status');\n      expect(response.body).toHaveProperty('redis');\n    });\n\n    it('should include environment information', async () => {\n      const response = await request(app)\n        .get('/health')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('environment');\n      expect(response.body.environment).toBe('test');\n    });\n  });\n\n  describe('GET /health/all', () => {\n    it('should return comprehensive health information', async () => {\n      const response = await request(app)\n        .get('/health/all')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('status');\n      expect(response.body).toHaveProperty('timestamp');\n    });\n\n    it('should include system metrics', async () => {\n      const response = await request(app)\n        .get('/health/metrics')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('system');\n      expect(response.body).toHaveProperty('timestamp');\n    });\n\n    it('should include database status in comprehensive check', async () => {\n      const response = await request(app)\n        .get('/health/all')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('services');\n      expect(response.body.services).toHaveProperty('mongodb');\n    });\n\n    it('should include Redis status in comprehensive check', async () => {\n      const response = await request(app)\n        .get('/health/all')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('services');\n      expect(response.body.services).toHaveProperty('redis');\n    });\n  });\n\n  describe('GET /health/ready', () => {\n    it('should return ready status', async () => {\n      const response = await request(app)\n        .get('/health/ready')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('status');\n      expect(response.body).toHaveProperty('services');\n      expect(response.body.status).toBe('ready');\n    });\n\n    it('should include service readiness checks', async () => {\n      const response = await request(app)\n        .get('/health/ready')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('services');\n      expect(response.body.services).toHaveProperty('database');\n      expect(response.body.services).toHaveProperty('redis');\n    });\n  });\n\n  describe('GET /health/live', () => {\n    it('should return liveness status', async () => {\n      const response = await request(app)\n        .get('/health/live')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('status');\n      expect(response.body).toHaveProperty('uptime');\n      expect(response.body.status).toBe('alive');\n    });\n\n    it('should include uptime information', async () => {\n      const response = await request(app)\n        .get('/health/live')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('uptime');\n      expect(typeof response.body.uptime).toBe('number');\n    });\n  });\n\n  describe('Health Check Error Handling', () => {\n    it('should handle database connection errors gracefully', async () => {\n      // This test would require mocking the database connection\n      // For now, we'll test that the health endpoint responds\n      const response = await request(app)\n        .get('/health')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('status');\n    });\n\n    it('should handle Redis connection errors gracefully', async () => {\n      // This test would require mocking the Redis connection\n      // For now, we'll test that the health endpoint responds\n      const response = await request(app)\n        .get('/health')\n        .expect(200);\n\n      expect(response.body).toHaveProperty('status');\n    });\n  });\n\n  describe('Health Check Performance', () => {\n    it('should respond quickly to health checks', async () => {\n      const startTime = Date.now();\n      \n      const response = await request(app)\n        .get('/health')\n        .expect(200);\n\n      const endTime = Date.now();\n      const responseTime = endTime - startTime;\n\n      // Health checks should respond within 100ms\n      expect(responseTime).toBeLessThan(100);\n      expect(response.body.status).toBe('ok');\n    });\n\n    it('should handle multiple concurrent health checks', async () => {\n      const promises = Array(10).fill().map(() =>\n        request(app).get('/health')\n      );\n\n      const responses = await Promise.all(promises);\n\n      responses.forEach(response => {\n        expect(response.status).toBe(200);\n        expect(response.body.status).toBe('ok');\n      });\n    });\n  });\n});"],"mappings":"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","ignoreList":[]}