FROM node:25-alpine

# Set working directory
WORKDIR /app

# Install dependencies first (for better caching)
COPY package*.json ./

# Install all dependencies including dev dependencies
RUN npm install --legacy-peer-deps

# Copy source code
COPY . .

# Expose port
EXPOSE 5173

# Add health check (using node to check if server is running)
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD node -e "require('http').get('http://localhost:5173', (res) => { process.exit(res.statusCode === 200 ? 0 : 1) }).on('error', () => process.exit(1))"

# Start development server with error handling
CMD ["sh", "-c", "echo 'ğŸš€ Starting Tripvar Client Development Server...' && echo 'ğŸ“¦ Dependencies installed:' && npm list --depth=0 2>/dev/null || echo 'âš ï¸  Some dependency warnings (non-critical)' && echo 'ğŸ”§ Starting Vite dev server...' && npm run dev -- --host 0.0.0.0 --port 5173"]