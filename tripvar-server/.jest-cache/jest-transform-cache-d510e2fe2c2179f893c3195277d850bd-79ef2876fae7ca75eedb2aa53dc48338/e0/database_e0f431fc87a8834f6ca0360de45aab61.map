{"version":3,"names":["cov_yy5jl5i23","actualCoverage","mongoose","s","require","info","error","warn","config","connectDB","f","database","uri","b","Error","connection","on","replace","nodeEnv","server","err","message","code","name","set","connectionOptions","options","authSource","retryWrites","w","connect","process","close","exit","stack","isDevelopment","undefined","module","exports"],"sources":["database.js"],"sourcesContent":["const mongoose = require('mongoose');\nconst { info, error, warn } = require('../utils/logger');\nconst config = require('./config');\n\nconst connectDB = async() => {\n  try {\n    const { database } = config;\n\n    // Validate MongoDB URI\n    if (!database.uri) {\n      throw new Error('MONGODB_URI is not defined in environment variables');\n    }\n\n    // Connection event handlers\n    mongoose.connection.on('connected', () => {\n      info('MongoDB connected successfully', {\n        uri: database.uri.replace(/\\/\\/.*@/, '//***:***@'), // Hide credentials in logs\n        nodeEnv: config.server.nodeEnv\n      });\n    });\n\n    mongoose.connection.on('error', (err) => {\n      error('MongoDB connection error', {\n        error: err.message,\n        code: err.code,\n        name: err.name\n      });\n    });\n\n    mongoose.connection.on('disconnected', () => {\n      warn('MongoDB disconnected');\n    });\n\n    mongoose.connection.on('reconnected', () => {\n      info('MongoDB reconnected');\n    });\n\n    // Set mongoose options\n    mongoose.set('strictQuery', false);\n\n    // Enhanced connection options\n    const connectionOptions = {\n      ...database.options,\n      authSource: 'tripvar', // Specify authentication database\n      retryWrites: true,\n      w: 'majority'\n    };\n\n    info('Attempting to connect to MongoDB', {\n      uri: database.uri.replace(/\\/\\/.*@/, '//***:***@'),\n      options: connectionOptions\n    });\n\n    // Connect with configuration\n    await mongoose.connect(database.uri, connectionOptions);\n\n    // Graceful shutdown\n    process.on('SIGINT', async() => {\n      try {\n        await mongoose.connection.close();\n        info('MongoDB connection closed through app termination');\n        process.exit(0);\n      } catch (err) {\n        error('Error closing MongoDB connection', { error: err.message });\n        process.exit(1);\n      }\n    });\n\n  } catch (err) {\n    error('Failed to connect to MongoDB', {\n      error: err.message,\n      stack: config.server.isDevelopment ? err.stack : undefined\n    });\n    throw err;\n  }\n};\n\nmodule.exports = connectDB;\n"],"mappings":"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","ignoreList":[]}