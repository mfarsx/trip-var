c08b1a5b3231205efcafd7488a0189ea
const Notification = require('../public/models/notification.model');
const {
  ValidationError,
  NotFoundError
} = require('../utils/errors');
const {
  successResponse
} = require('../utils/response');
const {
  info,
  error
} = require('../utils/logger');

// Get user's notifications
const getUserNotifications = async (req, res, next) => {
  try {
    const userId = req.user.id;
    const {
      page = 1,
      limit = 20,
      type,
      isRead,
      priority
    } = req.query;

    // Build query
    const query = {
      user: userId
    };
    if (type) {
      query.type = type;
    }
    if (isRead !== undefined) {
      query.isRead = isRead === 'true';
    }
    if (priority) {
      query.priority = priority;
    }

    // Calculate pagination
    const skip = (parseInt(page, 10) - 1) * parseInt(limit, 10);

    // Get notifications with pagination
    const notifications = await Notification.find(query).populate('booking', 'bookingReference checkInDate checkOutDate').populate('destination', 'title location imageUrl').sort({
      createdAt: -1
    }).skip(skip).limit(parseInt(limit, 10));

    // Get total count
    const total = await Notification.countDocuments(query);

    // Get unread count
    const unreadCount = await Notification.getUnreadCount(userId);
    res.json(successResponse({
      notifications,
      unreadCount,
      pagination: {
        current: parseInt(page, 10),
        pages: Math.ceil(total / parseInt(limit, 10)),
        total
      }
    }, 'Notifications retrieved successfully'));
  } catch (err) {
    error('Error fetching notifications', {
      error: err.message,
      userId: req.user?.id
    });
    next(err);
  }
};

// Mark notifications as read
const markNotificationsAsRead = async (req, res, next) => {
  try {
    const userId = req.user.id;
    const {
      notificationIds
    } = req.body;

    // If no specific IDs provided, mark all as read
    const result = await Notification.markAsRead(userId, notificationIds);
    info('Notifications marked as read', {
      userId,
      notificationIds,
      modifiedCount: result.modifiedCount
    });
    res.json(successResponse({
      modifiedCount: result.modifiedCount
    }, 'Notifications marked as read successfully'));
  } catch (err) {
    error('Error marking notifications as read', {
      error: err.message,
      userId: req.user?.id
    });
    next(err);
  }
};

// Delete notifications
const deleteNotifications = async (req, res, next) => {
  try {
    const userId = req.user.id;
    const {
      notificationIds
    } = req.body;
    if (!notificationIds || notificationIds.length === 0) {
      throw new ValidationError('Notification IDs are required');
    }
    const result = await Notification.deleteMany({
      _id: {
        $in: notificationIds
      },
      user: userId
    });
    info('Notifications deleted', {
      userId,
      notificationIds,
      deletedCount: result.deletedCount
    });
    res.json(successResponse({
      deletedCount: result.deletedCount
    }, 'Notifications deleted successfully'));
  } catch (err) {
    error('Error deleting notifications', {
      error: err.message,
      userId: req.user?.id
    });
    next(err);
  }
};

// Get notification by ID
const getNotificationById = async (req, res, next) => {
  try {
    const {
      notificationId
    } = req.params;
    const userId = req.user.id;
    const notification = await Notification.findOne({
      _id: notificationId,
      user: userId
    }).populate('booking', 'bookingReference checkInDate checkOutDate totalAmount').populate('destination', 'title location imageUrl');
    if (!notification) {
      throw new NotFoundError('Notification not found');
    }

    // Mark as read if not already read
    if (!notification.isRead) {
      notification.isRead = true;
      notification.readAt = new Date();
      await notification.save();
    }
    res.json(successResponse({
      notification
    }, 'Notification retrieved successfully'));
  } catch (err) {
    error('Error fetching notification', {
      error: err.message,
      notificationId: req.params.notificationId
    });
    next(err);
  }
};

// Get notification statistics
const getNotificationStats = async (req, res, next) => {
  try {
    const userId = req.user.id;
    const stats = await Notification.aggregate([{
      $match: {
        user: userId
      }
    }, {
      $group: {
        _id: null,
        total: {
          $sum: 1
        },
        unread: {
          $sum: {
            $cond: [{
              $eq: ['$isRead', false]
            }, 1, 0]
          }
        },
        byType: {
          $push: {
            type: '$type',
            isRead: '$isRead'
          }
        },
        byPriority: {
          $push: {
            priority: '$priority',
            isRead: '$isRead'
          }
        }
      }
    }]);
    let notificationStats = {
      total: 0,
      unread: 0,
      byType: {},
      byPriority: {}
    };
    if (stats.length > 0) {
      const stat = stats[0];
      notificationStats.total = stat.total;
      notificationStats.unread = stat.unread;

      // Calculate by type
      stat.byType.forEach(item => {
        if (!notificationStats.byType[item.type]) {
          notificationStats.byType[item.type] = {
            total: 0,
            unread: 0
          };
        }
        notificationStats.byType[item.type].total++;
        if (!item.isRead) {
          notificationStats.byType[item.type].unread++;
        }
      });

      // Calculate by priority
      stat.byPriority.forEach(item => {
        if (!notificationStats.byPriority[item.priority]) {
          notificationStats.byPriority[item.priority] = {
            total: 0,
            unread: 0
          };
        }
        notificationStats.byPriority[item.priority].total++;
        if (!item.isRead) {
          notificationStats.byPriority[item.priority].unread++;
        }
      });
    }
    res.json(successResponse({
      notificationStats
    }, 'Notification statistics retrieved successfully'));
  } catch (err) {
    error('Error fetching notification stats', {
      error: err.message,
      userId: req.user?.id
    });
    next(err);
  }
};

// Create notification (admin only)
const createNotification = async (req, res, next) => {
  try {
    const {
      userId,
      title,
      message,
      type,
      priority = 'medium',
      actionUrl,
      actionText,
      expiresAt
    } = req.body;

    // Validate required fields
    if (!userId || !title || !message || !type) {
      throw new ValidationError('Missing required notification information');
    }
    const notification = await Notification.createNotification({
      user: userId,
      title,
      message,
      type,
      priority,
      actionUrl,
      actionText,
      expiresAt: expiresAt ? new Date(expiresAt) : undefined
    });
    info('Notification created', {
      notificationId: notification._id,
      userId,
      type,
      priority
    });
    res.status(201).json(successResponse({
      notification
    }, 'Notification created successfully'));
  } catch (err) {
    error('Error creating notification', {
      error: err.message
    });
    next(err);
  }
};

// Get all notifications (admin only)
const getAllNotifications = async (req, res, next) => {
  try {
    const {
      page = 1,
      limit = 20,
      userId,
      type,
      isRead,
      priority
    } = req.query;

    // Build query
    const query = {};
    if (userId) {
      query.user = userId;
    }
    if (type) {
      query.type = type;
    }
    if (isRead !== undefined) {
      query.isRead = isRead === 'true';
    }
    if (priority) {
      query.priority = priority;
    }

    // Calculate pagination
    const skip = (parseInt(page, 10) - 1) * parseInt(limit, 10);

    // Get notifications with pagination
    const notifications = await Notification.find(query).populate('user', 'name email').populate('booking', 'bookingReference').populate('destination', 'title location').sort({
      createdAt: -1
    }).skip(skip).limit(parseInt(limit, 10));

    // Get total count
    const total = await Notification.countDocuments(query);
    res.json(successResponse({
      notifications,
      pagination: {
        current: parseInt(page, 10),
        pages: Math.ceil(total / parseInt(limit, 10)),
        total
      }
    }, 'All notifications retrieved successfully'));
  } catch (err) {
    error('Error fetching all notifications', {
      error: err.message
    });
    next(err);
  }
};

// Helper function to create system notifications
const createSystemNotification = async (userId, type, title, message, options = {}) => {
  try {
    const notification = await Notification.createNotification({
      user: userId,
      title,
      message,
      type,
      priority: options.priority || 'medium',
      actionUrl: options.actionUrl,
      actionText: options.actionText,
      expiresAt: options.expiresAt ? new Date(options.expiresAt) : undefined
    });
    info('System notification created', {
      notificationId: notification._id,
      userId,
      type
    });
    return notification;
  } catch (err) {
    error('Error creating system notification', {
      error: err.message,
      userId,
      type
    });
    throw err;
  }
};
module.exports = {
  getUserNotifications,
  markNotificationsAsRead,
  deleteNotifications,
  getNotificationById,
  getNotificationStats,
  createNotification,
  getAllNotifications,
  createSystemNotification
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOb3RpZmljYXRpb24iLCJyZXF1aXJlIiwiVmFsaWRhdGlvbkVycm9yIiwiTm90Rm91bmRFcnJvciIsInN1Y2Nlc3NSZXNwb25zZSIsImluZm8iLCJlcnJvciIsImdldFVzZXJOb3RpZmljYXRpb25zIiwicmVxIiwicmVzIiwibmV4dCIsInVzZXJJZCIsInVzZXIiLCJpZCIsInBhZ2UiLCJsaW1pdCIsInR5cGUiLCJpc1JlYWQiLCJwcmlvcml0eSIsInF1ZXJ5IiwidW5kZWZpbmVkIiwic2tpcCIsInBhcnNlSW50Iiwibm90aWZpY2F0aW9ucyIsImZpbmQiLCJwb3B1bGF0ZSIsInNvcnQiLCJjcmVhdGVkQXQiLCJ0b3RhbCIsImNvdW50RG9jdW1lbnRzIiwidW5yZWFkQ291bnQiLCJnZXRVbnJlYWRDb3VudCIsImpzb24iLCJwYWdpbmF0aW9uIiwiY3VycmVudCIsInBhZ2VzIiwiTWF0aCIsImNlaWwiLCJlcnIiLCJtZXNzYWdlIiwibWFya05vdGlmaWNhdGlvbnNBc1JlYWQiLCJub3RpZmljYXRpb25JZHMiLCJib2R5IiwicmVzdWx0IiwibWFya0FzUmVhZCIsIm1vZGlmaWVkQ291bnQiLCJkZWxldGVOb3RpZmljYXRpb25zIiwibGVuZ3RoIiwiZGVsZXRlTWFueSIsIl9pZCIsIiRpbiIsImRlbGV0ZWRDb3VudCIsImdldE5vdGlmaWNhdGlvbkJ5SWQiLCJub3RpZmljYXRpb25JZCIsInBhcmFtcyIsIm5vdGlmaWNhdGlvbiIsImZpbmRPbmUiLCJyZWFkQXQiLCJEYXRlIiwic2F2ZSIsImdldE5vdGlmaWNhdGlvblN0YXRzIiwic3RhdHMiLCJhZ2dyZWdhdGUiLCIkbWF0Y2giLCIkZ3JvdXAiLCIkc3VtIiwidW5yZWFkIiwiJGNvbmQiLCIkZXEiLCJieVR5cGUiLCIkcHVzaCIsImJ5UHJpb3JpdHkiLCJub3RpZmljYXRpb25TdGF0cyIsInN0YXQiLCJmb3JFYWNoIiwiaXRlbSIsImNyZWF0ZU5vdGlmaWNhdGlvbiIsInRpdGxlIiwiYWN0aW9uVXJsIiwiYWN0aW9uVGV4dCIsImV4cGlyZXNBdCIsInN0YXR1cyIsImdldEFsbE5vdGlmaWNhdGlvbnMiLCJjcmVhdGVTeXN0ZW1Ob3RpZmljYXRpb24iLCJvcHRpb25zIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIm5vdGlmaWNhdGlvbi5jb250cm9sbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IE5vdGlmaWNhdGlvbiA9IHJlcXVpcmUoJy4uL3B1YmxpYy9tb2RlbHMvbm90aWZpY2F0aW9uLm1vZGVsJyk7XG5jb25zdCB7IFZhbGlkYXRpb25FcnJvciwgTm90Rm91bmRFcnJvciB9ID0gcmVxdWlyZSgnLi4vdXRpbHMvZXJyb3JzJyk7XG5jb25zdCB7IHN1Y2Nlc3NSZXNwb25zZSB9ID0gcmVxdWlyZSgnLi4vdXRpbHMvcmVzcG9uc2UnKTtcbmNvbnN0IHsgaW5mbywgZXJyb3IgfSA9IHJlcXVpcmUoJy4uL3V0aWxzL2xvZ2dlcicpO1xuXG4vLyBHZXQgdXNlcidzIG5vdGlmaWNhdGlvbnNcbmNvbnN0IGdldFVzZXJOb3RpZmljYXRpb25zID0gYXN5bmMocmVxLCByZXMsIG5leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VySWQgPSByZXEudXNlci5pZDtcbiAgICBjb25zdCB7IHBhZ2UgPSAxLCBsaW1pdCA9IDIwLCB0eXBlLCBpc1JlYWQsIHByaW9yaXR5IH0gPSByZXEucXVlcnk7XG5cbiAgICAvLyBCdWlsZCBxdWVyeVxuICAgIGNvbnN0IHF1ZXJ5ID0geyB1c2VyOiB1c2VySWQgfTtcbiAgICBpZiAodHlwZSkge1xuICAgICAgcXVlcnkudHlwZSA9IHR5cGU7XG4gICAgfVxuICAgIGlmIChpc1JlYWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcXVlcnkuaXNSZWFkID0gaXNSZWFkID09PSAndHJ1ZSc7XG4gICAgfVxuICAgIGlmIChwcmlvcml0eSkge1xuICAgICAgcXVlcnkucHJpb3JpdHkgPSBwcmlvcml0eTtcbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgcGFnaW5hdGlvblxuICAgIGNvbnN0IHNraXAgPSAocGFyc2VJbnQocGFnZSwgMTApIC0gMSkgKiBwYXJzZUludChsaW1pdCwgMTApO1xuXG4gICAgLy8gR2V0IG5vdGlmaWNhdGlvbnMgd2l0aCBwYWdpbmF0aW9uXG4gICAgY29uc3Qgbm90aWZpY2F0aW9ucyA9IGF3YWl0IE5vdGlmaWNhdGlvbi5maW5kKHF1ZXJ5KVxuICAgICAgLnBvcHVsYXRlKCdib29raW5nJywgJ2Jvb2tpbmdSZWZlcmVuY2UgY2hlY2tJbkRhdGUgY2hlY2tPdXREYXRlJylcbiAgICAgIC5wb3B1bGF0ZSgnZGVzdGluYXRpb24nLCAndGl0bGUgbG9jYXRpb24gaW1hZ2VVcmwnKVxuICAgICAgLnNvcnQoeyBjcmVhdGVkQXQ6IC0xIH0pXG4gICAgICAuc2tpcChza2lwKVxuICAgICAgLmxpbWl0KHBhcnNlSW50KGxpbWl0LCAxMCkpO1xuXG4gICAgLy8gR2V0IHRvdGFsIGNvdW50XG4gICAgY29uc3QgdG90YWwgPSBhd2FpdCBOb3RpZmljYXRpb24uY291bnREb2N1bWVudHMocXVlcnkpO1xuXG4gICAgLy8gR2V0IHVucmVhZCBjb3VudFxuICAgIGNvbnN0IHVucmVhZENvdW50ID0gYXdhaXQgTm90aWZpY2F0aW9uLmdldFVucmVhZENvdW50KHVzZXJJZCk7XG5cbiAgICByZXMuanNvbihcbiAgICAgIHN1Y2Nlc3NSZXNwb25zZShcbiAgICAgICAge1xuICAgICAgICAgIG5vdGlmaWNhdGlvbnMsXG4gICAgICAgICAgdW5yZWFkQ291bnQsXG4gICAgICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICAgICAgY3VycmVudDogcGFyc2VJbnQocGFnZSwgMTApLFxuICAgICAgICAgICAgcGFnZXM6IE1hdGguY2VpbCh0b3RhbCAvIHBhcnNlSW50KGxpbWl0LCAxMCkpLFxuICAgICAgICAgICAgdG90YWxcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgICdOb3RpZmljYXRpb25zIHJldHJpZXZlZCBzdWNjZXNzZnVsbHknXG4gICAgICApXG4gICAgKTtcblxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBlcnJvcignRXJyb3IgZmV0Y2hpbmcgbm90aWZpY2F0aW9ucycsIHsgZXJyb3I6IGVyci5tZXNzYWdlLCB1c2VySWQ6IHJlcS51c2VyPy5pZCB9KTtcbiAgICBuZXh0KGVycik7XG4gIH1cbn07XG5cbi8vIE1hcmsgbm90aWZpY2F0aW9ucyBhcyByZWFkXG5jb25zdCBtYXJrTm90aWZpY2F0aW9uc0FzUmVhZCA9IGFzeW5jKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXNlcklkID0gcmVxLnVzZXIuaWQ7XG4gICAgY29uc3QgeyBub3RpZmljYXRpb25JZHMgfSA9IHJlcS5ib2R5O1xuXG4gICAgLy8gSWYgbm8gc3BlY2lmaWMgSURzIHByb3ZpZGVkLCBtYXJrIGFsbCBhcyByZWFkXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgTm90aWZpY2F0aW9uLm1hcmtBc1JlYWQodXNlcklkLCBub3RpZmljYXRpb25JZHMpO1xuXG4gICAgaW5mbygnTm90aWZpY2F0aW9ucyBtYXJrZWQgYXMgcmVhZCcsIHtcbiAgICAgIHVzZXJJZCxcbiAgICAgIG5vdGlmaWNhdGlvbklkcyxcbiAgICAgIG1vZGlmaWVkQ291bnQ6IHJlc3VsdC5tb2RpZmllZENvdW50XG4gICAgfSk7XG5cbiAgICByZXMuanNvbihcbiAgICAgIHN1Y2Nlc3NSZXNwb25zZShcbiAgICAgICAge1xuICAgICAgICAgIG1vZGlmaWVkQ291bnQ6IHJlc3VsdC5tb2RpZmllZENvdW50XG4gICAgICAgIH0sXG4gICAgICAgICdOb3RpZmljYXRpb25zIG1hcmtlZCBhcyByZWFkIHN1Y2Nlc3NmdWxseSdcbiAgICAgIClcbiAgICApO1xuXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGVycm9yKCdFcnJvciBtYXJraW5nIG5vdGlmaWNhdGlvbnMgYXMgcmVhZCcsIHsgZXJyb3I6IGVyci5tZXNzYWdlLCB1c2VySWQ6IHJlcS51c2VyPy5pZCB9KTtcbiAgICBuZXh0KGVycik7XG4gIH1cbn07XG5cbi8vIERlbGV0ZSBub3RpZmljYXRpb25zXG5jb25zdCBkZWxldGVOb3RpZmljYXRpb25zID0gYXN5bmMocmVxLCByZXMsIG5leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VySWQgPSByZXEudXNlci5pZDtcbiAgICBjb25zdCB7IG5vdGlmaWNhdGlvbklkcyB9ID0gcmVxLmJvZHk7XG5cbiAgICBpZiAoIW5vdGlmaWNhdGlvbklkcyB8fCBub3RpZmljYXRpb25JZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgVmFsaWRhdGlvbkVycm9yKCdOb3RpZmljYXRpb24gSURzIGFyZSByZXF1aXJlZCcpO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IE5vdGlmaWNhdGlvbi5kZWxldGVNYW55KHtcbiAgICAgIF9pZDogeyAkaW46IG5vdGlmaWNhdGlvbklkcyB9LFxuICAgICAgdXNlcjogdXNlcklkXG4gICAgfSk7XG5cbiAgICBpbmZvKCdOb3RpZmljYXRpb25zIGRlbGV0ZWQnLCB7XG4gICAgICB1c2VySWQsXG4gICAgICBub3RpZmljYXRpb25JZHMsXG4gICAgICBkZWxldGVkQ291bnQ6IHJlc3VsdC5kZWxldGVkQ291bnRcbiAgICB9KTtcblxuICAgIHJlcy5qc29uKFxuICAgICAgc3VjY2Vzc1Jlc3BvbnNlKFxuICAgICAgICB7XG4gICAgICAgICAgZGVsZXRlZENvdW50OiByZXN1bHQuZGVsZXRlZENvdW50XG4gICAgICAgIH0sXG4gICAgICAgICdOb3RpZmljYXRpb25zIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5J1xuICAgICAgKVxuICAgICk7XG5cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgZXJyb3IoJ0Vycm9yIGRlbGV0aW5nIG5vdGlmaWNhdGlvbnMnLCB7IGVycm9yOiBlcnIubWVzc2FnZSwgdXNlcklkOiByZXEudXNlcj8uaWQgfSk7XG4gICAgbmV4dChlcnIpO1xuICB9XG59O1xuXG4vLyBHZXQgbm90aWZpY2F0aW9uIGJ5IElEXG5jb25zdCBnZXROb3RpZmljYXRpb25CeUlkID0gYXN5bmMocmVxLCByZXMsIG5leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IG5vdGlmaWNhdGlvbklkIH0gPSByZXEucGFyYW1zO1xuICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyLmlkO1xuXG4gICAgY29uc3Qgbm90aWZpY2F0aW9uID0gYXdhaXQgTm90aWZpY2F0aW9uLmZpbmRPbmUoe1xuICAgICAgX2lkOiBub3RpZmljYXRpb25JZCxcbiAgICAgIHVzZXI6IHVzZXJJZFxuICAgIH0pXG4gICAgICAucG9wdWxhdGUoJ2Jvb2tpbmcnLCAnYm9va2luZ1JlZmVyZW5jZSBjaGVja0luRGF0ZSBjaGVja091dERhdGUgdG90YWxBbW91bnQnKVxuICAgICAgLnBvcHVsYXRlKCdkZXN0aW5hdGlvbicsICd0aXRsZSBsb2NhdGlvbiBpbWFnZVVybCcpO1xuXG4gICAgaWYgKCFub3RpZmljYXRpb24pIHtcbiAgICAgIHRocm93IG5ldyBOb3RGb3VuZEVycm9yKCdOb3RpZmljYXRpb24gbm90IGZvdW5kJyk7XG4gICAgfVxuXG4gICAgLy8gTWFyayBhcyByZWFkIGlmIG5vdCBhbHJlYWR5IHJlYWRcbiAgICBpZiAoIW5vdGlmaWNhdGlvbi5pc1JlYWQpIHtcbiAgICAgIG5vdGlmaWNhdGlvbi5pc1JlYWQgPSB0cnVlO1xuICAgICAgbm90aWZpY2F0aW9uLnJlYWRBdCA9IG5ldyBEYXRlKCk7XG4gICAgICBhd2FpdCBub3RpZmljYXRpb24uc2F2ZSgpO1xuICAgIH1cblxuICAgIHJlcy5qc29uKFxuICAgICAgc3VjY2Vzc1Jlc3BvbnNlKFxuICAgICAgICB7IG5vdGlmaWNhdGlvbiB9LFxuICAgICAgICAnTm90aWZpY2F0aW9uIHJldHJpZXZlZCBzdWNjZXNzZnVsbHknXG4gICAgICApXG4gICAgKTtcblxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBlcnJvcignRXJyb3IgZmV0Y2hpbmcgbm90aWZpY2F0aW9uJywgeyBlcnJvcjogZXJyLm1lc3NhZ2UsIG5vdGlmaWNhdGlvbklkOiByZXEucGFyYW1zLm5vdGlmaWNhdGlvbklkIH0pO1xuICAgIG5leHQoZXJyKTtcbiAgfVxufTtcblxuLy8gR2V0IG5vdGlmaWNhdGlvbiBzdGF0aXN0aWNzXG5jb25zdCBnZXROb3RpZmljYXRpb25TdGF0cyA9IGFzeW5jKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXNlcklkID0gcmVxLnVzZXIuaWQ7XG5cbiAgICBjb25zdCBzdGF0cyA9IGF3YWl0IE5vdGlmaWNhdGlvbi5hZ2dyZWdhdGUoW1xuICAgICAgeyAkbWF0Y2g6IHsgdXNlcjogdXNlcklkIH0gfSxcbiAgICAgIHtcbiAgICAgICAgJGdyb3VwOiB7XG4gICAgICAgICAgX2lkOiBudWxsLFxuICAgICAgICAgIHRvdGFsOiB7ICRzdW06IDEgfSxcbiAgICAgICAgICB1bnJlYWQ6IHtcbiAgICAgICAgICAgICRzdW06IHsgJGNvbmQ6IFt7ICRlcTogWyckaXNSZWFkJywgZmFsc2VdIH0sIDEsIDBdIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGJ5VHlwZToge1xuICAgICAgICAgICAgJHB1c2g6IHtcbiAgICAgICAgICAgICAgdHlwZTogJyR0eXBlJyxcbiAgICAgICAgICAgICAgaXNSZWFkOiAnJGlzUmVhZCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGJ5UHJpb3JpdHk6IHtcbiAgICAgICAgICAgICRwdXNoOiB7XG4gICAgICAgICAgICAgIHByaW9yaXR5OiAnJHByaW9yaXR5JyxcbiAgICAgICAgICAgICAgaXNSZWFkOiAnJGlzUmVhZCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBdKTtcblxuICAgIGxldCBub3RpZmljYXRpb25TdGF0cyA9IHtcbiAgICAgIHRvdGFsOiAwLFxuICAgICAgdW5yZWFkOiAwLFxuICAgICAgYnlUeXBlOiB7fSxcbiAgICAgIGJ5UHJpb3JpdHk6IHt9XG4gICAgfTtcblxuICAgIGlmIChzdGF0cy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBzdGF0ID0gc3RhdHNbMF07XG4gICAgICBub3RpZmljYXRpb25TdGF0cy50b3RhbCA9IHN0YXQudG90YWw7XG4gICAgICBub3RpZmljYXRpb25TdGF0cy51bnJlYWQgPSBzdGF0LnVucmVhZDtcblxuICAgICAgLy8gQ2FsY3VsYXRlIGJ5IHR5cGVcbiAgICAgIHN0YXQuYnlUeXBlLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGlmICghbm90aWZpY2F0aW9uU3RhdHMuYnlUeXBlW2l0ZW0udHlwZV0pIHtcbiAgICAgICAgICBub3RpZmljYXRpb25TdGF0cy5ieVR5cGVbaXRlbS50eXBlXSA9IHsgdG90YWw6IDAsIHVucmVhZDogMCB9O1xuICAgICAgICB9XG4gICAgICAgIG5vdGlmaWNhdGlvblN0YXRzLmJ5VHlwZVtpdGVtLnR5cGVdLnRvdGFsKys7XG4gICAgICAgIGlmICghaXRlbS5pc1JlYWQpIHtcbiAgICAgICAgICBub3RpZmljYXRpb25TdGF0cy5ieVR5cGVbaXRlbS50eXBlXS51bnJlYWQrKztcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBieSBwcmlvcml0eVxuICAgICAgc3RhdC5ieVByaW9yaXR5LmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGlmICghbm90aWZpY2F0aW9uU3RhdHMuYnlQcmlvcml0eVtpdGVtLnByaW9yaXR5XSkge1xuICAgICAgICAgIG5vdGlmaWNhdGlvblN0YXRzLmJ5UHJpb3JpdHlbaXRlbS5wcmlvcml0eV0gPSB7IHRvdGFsOiAwLCB1bnJlYWQ6IDAgfTtcbiAgICAgICAgfVxuICAgICAgICBub3RpZmljYXRpb25TdGF0cy5ieVByaW9yaXR5W2l0ZW0ucHJpb3JpdHldLnRvdGFsKys7XG4gICAgICAgIGlmICghaXRlbS5pc1JlYWQpIHtcbiAgICAgICAgICBub3RpZmljYXRpb25TdGF0cy5ieVByaW9yaXR5W2l0ZW0ucHJpb3JpdHldLnVucmVhZCsrO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXMuanNvbihcbiAgICAgIHN1Y2Nlc3NSZXNwb25zZShcbiAgICAgICAgeyBub3RpZmljYXRpb25TdGF0cyB9LFxuICAgICAgICAnTm90aWZpY2F0aW9uIHN0YXRpc3RpY3MgcmV0cmlldmVkIHN1Y2Nlc3NmdWxseSdcbiAgICAgIClcbiAgICApO1xuXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGVycm9yKCdFcnJvciBmZXRjaGluZyBub3RpZmljYXRpb24gc3RhdHMnLCB7IGVycm9yOiBlcnIubWVzc2FnZSwgdXNlcklkOiByZXEudXNlcj8uaWQgfSk7XG4gICAgbmV4dChlcnIpO1xuICB9XG59O1xuXG4vLyBDcmVhdGUgbm90aWZpY2F0aW9uIChhZG1pbiBvbmx5KVxuY29uc3QgY3JlYXRlTm90aWZpY2F0aW9uID0gYXN5bmMocmVxLCByZXMsIG5leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7XG4gICAgICB1c2VySWQsXG4gICAgICB0aXRsZSxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICB0eXBlLFxuICAgICAgcHJpb3JpdHkgPSAnbWVkaXVtJyxcbiAgICAgIGFjdGlvblVybCxcbiAgICAgIGFjdGlvblRleHQsXG4gICAgICBleHBpcmVzQXRcbiAgICB9ID0gcmVxLmJvZHk7XG5cbiAgICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBmaWVsZHNcbiAgICBpZiAoIXVzZXJJZCB8fCAhdGl0bGUgfHwgIW1lc3NhZ2UgfHwgIXR5cGUpIHtcbiAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoJ01pc3NpbmcgcmVxdWlyZWQgbm90aWZpY2F0aW9uIGluZm9ybWF0aW9uJyk7XG4gICAgfVxuXG4gICAgY29uc3Qgbm90aWZpY2F0aW9uID0gYXdhaXQgTm90aWZpY2F0aW9uLmNyZWF0ZU5vdGlmaWNhdGlvbih7XG4gICAgICB1c2VyOiB1c2VySWQsXG4gICAgICB0aXRsZSxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICB0eXBlLFxuICAgICAgcHJpb3JpdHksXG4gICAgICBhY3Rpb25VcmwsXG4gICAgICBhY3Rpb25UZXh0LFxuICAgICAgZXhwaXJlc0F0OiBleHBpcmVzQXQgPyBuZXcgRGF0ZShleHBpcmVzQXQpIDogdW5kZWZpbmVkXG4gICAgfSk7XG5cbiAgICBpbmZvKCdOb3RpZmljYXRpb24gY3JlYXRlZCcsIHtcbiAgICAgIG5vdGlmaWNhdGlvbklkOiBub3RpZmljYXRpb24uX2lkLFxuICAgICAgdXNlcklkLFxuICAgICAgdHlwZSxcbiAgICAgIHByaW9yaXR5XG4gICAgfSk7XG5cbiAgICByZXMuc3RhdHVzKDIwMSkuanNvbihcbiAgICAgIHN1Y2Nlc3NSZXNwb25zZShcbiAgICAgICAgeyBub3RpZmljYXRpb24gfSxcbiAgICAgICAgJ05vdGlmaWNhdGlvbiBjcmVhdGVkIHN1Y2Nlc3NmdWxseSdcbiAgICAgIClcbiAgICApO1xuXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGVycm9yKCdFcnJvciBjcmVhdGluZyBub3RpZmljYXRpb24nLCB7IGVycm9yOiBlcnIubWVzc2FnZSB9KTtcbiAgICBuZXh0KGVycik7XG4gIH1cbn07XG5cbi8vIEdldCBhbGwgbm90aWZpY2F0aW9ucyAoYWRtaW4gb25seSlcbmNvbnN0IGdldEFsbE5vdGlmaWNhdGlvbnMgPSBhc3luYyhyZXEsIHJlcywgbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgcGFnZSA9IDEsIGxpbWl0ID0gMjAsIHVzZXJJZCwgdHlwZSwgaXNSZWFkLCBwcmlvcml0eSB9ID0gcmVxLnF1ZXJ5O1xuXG4gICAgLy8gQnVpbGQgcXVlcnlcbiAgICBjb25zdCBxdWVyeSA9IHt9O1xuICAgIGlmICh1c2VySWQpIHtcbiAgICAgIHF1ZXJ5LnVzZXIgPSB1c2VySWQ7XG4gICAgfVxuICAgIGlmICh0eXBlKSB7XG4gICAgICBxdWVyeS50eXBlID0gdHlwZTtcbiAgICB9XG4gICAgaWYgKGlzUmVhZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBxdWVyeS5pc1JlYWQgPSBpc1JlYWQgPT09ICd0cnVlJztcbiAgICB9XG4gICAgaWYgKHByaW9yaXR5KSB7XG4gICAgICBxdWVyeS5wcmlvcml0eSA9IHByaW9yaXR5O1xuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSBwYWdpbmF0aW9uXG4gICAgY29uc3Qgc2tpcCA9IChwYXJzZUludChwYWdlLCAxMCkgLSAxKSAqIHBhcnNlSW50KGxpbWl0LCAxMCk7XG5cbiAgICAvLyBHZXQgbm90aWZpY2F0aW9ucyB3aXRoIHBhZ2luYXRpb25cbiAgICBjb25zdCBub3RpZmljYXRpb25zID0gYXdhaXQgTm90aWZpY2F0aW9uLmZpbmQocXVlcnkpXG4gICAgICAucG9wdWxhdGUoJ3VzZXInLCAnbmFtZSBlbWFpbCcpXG4gICAgICAucG9wdWxhdGUoJ2Jvb2tpbmcnLCAnYm9va2luZ1JlZmVyZW5jZScpXG4gICAgICAucG9wdWxhdGUoJ2Rlc3RpbmF0aW9uJywgJ3RpdGxlIGxvY2F0aW9uJylcbiAgICAgIC5zb3J0KHsgY3JlYXRlZEF0OiAtMSB9KVxuICAgICAgLnNraXAoc2tpcClcbiAgICAgIC5saW1pdChwYXJzZUludChsaW1pdCwgMTApKTtcblxuICAgIC8vIEdldCB0b3RhbCBjb3VudFxuICAgIGNvbnN0IHRvdGFsID0gYXdhaXQgTm90aWZpY2F0aW9uLmNvdW50RG9jdW1lbnRzKHF1ZXJ5KTtcblxuICAgIHJlcy5qc29uKFxuICAgICAgc3VjY2Vzc1Jlc3BvbnNlKFxuICAgICAgICB7XG4gICAgICAgICAgbm90aWZpY2F0aW9ucyxcbiAgICAgICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgICAgICBjdXJyZW50OiBwYXJzZUludChwYWdlLCAxMCksXG4gICAgICAgICAgICBwYWdlczogTWF0aC5jZWlsKHRvdGFsIC8gcGFyc2VJbnQobGltaXQsIDEwKSksXG4gICAgICAgICAgICB0b3RhbFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgJ0FsbCBub3RpZmljYXRpb25zIHJldHJpZXZlZCBzdWNjZXNzZnVsbHknXG4gICAgICApXG4gICAgKTtcblxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBlcnJvcignRXJyb3IgZmV0Y2hpbmcgYWxsIG5vdGlmaWNhdGlvbnMnLCB7IGVycm9yOiBlcnIubWVzc2FnZSB9KTtcbiAgICBuZXh0KGVycik7XG4gIH1cbn07XG5cbi8vIEhlbHBlciBmdW5jdGlvbiB0byBjcmVhdGUgc3lzdGVtIG5vdGlmaWNhdGlvbnNcbmNvbnN0IGNyZWF0ZVN5c3RlbU5vdGlmaWNhdGlvbiA9IGFzeW5jKHVzZXJJZCwgdHlwZSwgdGl0bGUsIG1lc3NhZ2UsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGF3YWl0IE5vdGlmaWNhdGlvbi5jcmVhdGVOb3RpZmljYXRpb24oe1xuICAgICAgdXNlcjogdXNlcklkLFxuICAgICAgdGl0bGUsXG4gICAgICBtZXNzYWdlLFxuICAgICAgdHlwZSxcbiAgICAgIHByaW9yaXR5OiBvcHRpb25zLnByaW9yaXR5IHx8ICdtZWRpdW0nLFxuICAgICAgYWN0aW9uVXJsOiBvcHRpb25zLmFjdGlvblVybCxcbiAgICAgIGFjdGlvblRleHQ6IG9wdGlvbnMuYWN0aW9uVGV4dCxcbiAgICAgIGV4cGlyZXNBdDogb3B0aW9ucy5leHBpcmVzQXQgPyBuZXcgRGF0ZShvcHRpb25zLmV4cGlyZXNBdCkgOiB1bmRlZmluZWRcbiAgICB9KTtcblxuICAgIGluZm8oJ1N5c3RlbSBub3RpZmljYXRpb24gY3JlYXRlZCcsIHtcbiAgICAgIG5vdGlmaWNhdGlvbklkOiBub3RpZmljYXRpb24uX2lkLFxuICAgICAgdXNlcklkLFxuICAgICAgdHlwZVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5vdGlmaWNhdGlvbjtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHN5c3RlbSBub3RpZmljYXRpb24nLCB7IGVycm9yOiBlcnIubWVzc2FnZSwgdXNlcklkLCB0eXBlIH0pO1xuICAgIHRocm93IGVycjtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGdldFVzZXJOb3RpZmljYXRpb25zLFxuICBtYXJrTm90aWZpY2F0aW9uc0FzUmVhZCxcbiAgZGVsZXRlTm90aWZpY2F0aW9ucyxcbiAgZ2V0Tm90aWZpY2F0aW9uQnlJZCxcbiAgZ2V0Tm90aWZpY2F0aW9uU3RhdHMsXG4gIGNyZWF0ZU5vdGlmaWNhdGlvbixcbiAgZ2V0QWxsTm90aWZpY2F0aW9ucyxcbiAgY3JlYXRlU3lzdGVtTm90aWZpY2F0aW9uXG59OyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsWUFBWSxHQUFHQyxPQUFPLENBQUMscUNBQXFDLENBQUM7QUFDbkUsTUFBTTtFQUFFQyxlQUFlO0VBQUVDO0FBQWMsQ0FBQyxHQUFHRixPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDckUsTUFBTTtFQUFFRztBQUFnQixDQUFDLEdBQUdILE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztBQUN4RCxNQUFNO0VBQUVJLElBQUk7RUFBRUM7QUFBTSxDQUFDLEdBQUdMLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQzs7QUFFbEQ7QUFDQSxNQUFNTSxvQkFBb0IsR0FBRyxNQUFBQSxDQUFNQyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0VBQ3BELElBQUk7SUFDRixNQUFNQyxNQUFNLEdBQUdILEdBQUcsQ0FBQ0ksSUFBSSxDQUFDQyxFQUFFO0lBQzFCLE1BQU07TUFBRUMsSUFBSSxHQUFHLENBQUM7TUFBRUMsS0FBSyxHQUFHLEVBQUU7TUFBRUMsSUFBSTtNQUFFQyxNQUFNO01BQUVDO0lBQVMsQ0FBQyxHQUFHVixHQUFHLENBQUNXLEtBQUs7O0lBRWxFO0lBQ0EsTUFBTUEsS0FBSyxHQUFHO01BQUVQLElBQUksRUFBRUQ7SUFBTyxDQUFDO0lBQzlCLElBQUlLLElBQUksRUFBRTtNQUNSRyxLQUFLLENBQUNILElBQUksR0FBR0EsSUFBSTtJQUNuQjtJQUNBLElBQUlDLE1BQU0sS0FBS0csU0FBUyxFQUFFO01B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