{"version":3,"names":["_getJestObj","mock","connectRedis","jest","fn","mockResolvedValue","disconnectRedis","getRedisClient","get","set","del","exists","expire","flushall","ping","quit","status","redisUtils","deleteCache","getCache","setCache","require","express","cors","helmet","compression","rateLimit","slowDown","authRoutes","destinationRoutes","bookingRoutes","healthRoutes","errorHandler","app","use","contentSecurityPolicy","crossOriginEmbedderPolicy","origin","process","env","ALLOWED_ORIGINS","split","credentials","limiter","windowMs","max","message","speedLimiter","delayAfter","delayMs","validate","json","limit","urlencoded","extended","req","res","next","error","Error","originalUrl","statusCode","code","isOperational","module","exports"],"sources":["app.test.js"],"sourcesContent":["// Test-specific app configuration that doesn't connect to external services\nconst express = require('express');\nconst cors = require('cors');\nconst helmet = require('helmet');\nconst compression = require('compression');\nconst rateLimit = require('express-rate-limit');\nconst slowDown = require('express-slow-down');\n\n// Mock external services before importing routes\njest.mock('../config/redis', () => ({\n  connectRedis: jest.fn().mockResolvedValue(),\n  disconnectRedis: jest.fn().mockResolvedValue(),\n  getRedisClient: jest.fn(() => ({\n    get: jest.fn().mockResolvedValue(null),\n    set: jest.fn().mockResolvedValue('OK'),\n    del: jest.fn().mockResolvedValue(1),\n    exists: jest.fn().mockResolvedValue(0),\n    expire: jest.fn().mockResolvedValue(1),\n    flushall: jest.fn().mockResolvedValue('OK'),\n    ping: jest.fn().mockResolvedValue('PONG'),\n    quit: jest.fn().mockResolvedValue('OK'),\n    status: 'ready'\n  })),\n  redisUtils: {\n    deleteCache: jest.fn().mockResolvedValue(true),\n    getCache: jest.fn().mockResolvedValue(null),\n    setCache: jest.fn().mockResolvedValue('OK'),\n    exists: jest.fn().mockResolvedValue(false),\n    expire: jest.fn().mockResolvedValue(true),\n    flushall: jest.fn().mockResolvedValue('OK')\n  }\n}));\n\n// Import routes\nconst authRoutes = require('../routes/auth.routes');\nconst destinationRoutes = require('../routes/destination.routes');\nconst bookingRoutes = require('../routes/booking.routes');\nconst healthRoutes = require('../routes/health.routes');\n\n// Import middleware\nconst errorHandler = require('../middleware/errorHandler');\n\n// Create Express app\nconst app = express();\n\n// Security middleware\napp.use(helmet({\n  contentSecurityPolicy: false, // Disable for testing\n  crossOriginEmbedderPolicy: false\n}));\n\n// CORS configuration\napp.use(cors({\n  origin: process.env.ALLOWED_ORIGINS?.split(',') || ['http://localhost:3000', 'http://localhost:5173'],\n  credentials: true\n}));\n\n// Compression middleware\napp.use(compression());\n\n// Rate limiting\nconst limiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 100, // limit each IP to 100 requests per windowMs\n  message: 'Too many requests from this IP, please try again later.'\n});\napp.use('/api/', limiter);\n\n// Speed limiting\nconst speedLimiter = slowDown({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  delayAfter: 50, // allow 50 requests per 15 minutes, then...\n  delayMs: () => 500, // begin adding 500ms of delay per request above 50\n  validate: { delayMs: false } // Disable validation warning\n});\napp.use('/api/', speedLimiter);\n\n// Body parsing middleware\napp.use(express.json({ limit: '10mb' }));\napp.use(express.urlencoded({ extended: true, limit: '10mb' }));\n\n\n\n// Request validation middleware (disabled for tests)\n// app.use(validateRequest);\n\n// Routes\napp.use('/api/v1/auth', authRoutes);\napp.use('/api/v1/destinations', destinationRoutes);\napp.use('/api/v1/bookings', bookingRoutes);\napp.use('/health', healthRoutes);\n\n// 404 handler for undefined routes\napp.use('*', (req, res, next) => {\n  const error = new Error(`Route ${req.originalUrl} not found`);\n  error.statusCode = 404;\n  error.status = 'fail';\n  error.code = 'ROUTE_NOT_FOUND';\n  error.isOperational = true;\n  next(error);\n});\n\n// Error handling middleware (must be last)\napp.use(errorHandler);\n\nmodule.exports = app;"],"mappings":"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","ignoreList":[]}