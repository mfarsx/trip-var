5e0f9b8fd78203d87183b39c0a26290b
const {
  successResponse,
  paginatedResponse
} = require('../utils/response');
const {
  asyncHandler
} = require('../utils/asyncHandler');
const {
  ValidationError
} = require('../utils/errors');

/**
 * Base controller class with common functionality
 */
class BaseController {
  /**
   * Send success response
   * @param {Object} res - Express response object
   * @param {*} data - Response data
   * @param {string} message - Success message
   * @param {number} statusCode - HTTP status code
   */
  sendSuccess(res, data = null, message = 'Success', statusCode = 200) {
    res.status(statusCode).json(successResponse(data, message));
  }

  /**
   * Send paginated response
   * @param {Object} res - Express response object
   * @param {Array} data - Response data
   * @param {number} page - Current page
   * @param {number} limit - Items per page
   * @param {number} total - Total items
   * @param {string} message - Success message
   */
  sendPaginated(res, data, page, limit, total) {
    res.status(200).json(paginatedResponse(data, page, limit, total));
  }

  /**
   * Validate request body
   * @param {Object} body - Request body
   * @param {Array<string>} requiredFields - Required field names
   * @throws {ValidationError} If validation fails
   */
  validateRequestBody(body, requiredFields) {
    const missingFields = requiredFields.filter(field => body[field] === undefined || body[field] === null || body[field] === '');
    if (missingFields.length > 0) {
      throw new ValidationError(`Missing required fields: ${missingFields.join(', ')}`, {
        missingFields
      });
    }
  }

  /**
   * Validate request parameters
   * @param {Object} params - Request parameters
   * @param {Array<string>} requiredParams - Required parameter names
   * @throws {ValidationError} If validation fails
   */
  validateRequestParams(params, requiredParams) {
    const missingParams = requiredParams.filter(param => !params[param] || params[param] === '');
    if (missingParams.length > 0) {
      throw new ValidationError(`Missing required parameters: ${missingParams.join(', ')}`, {
        missingParams
      });
    }
  }

  /**
   * Sanitize request body
   * @param {Object} body - Request body
   * @param {Array<string>} allowedFields - Allowed field names
   * @returns {Object} Sanitized body
   */
  sanitizeRequestBody(body, allowedFields) {
    const sanitized = {};
    Object.keys(body).forEach(key => {
      if (allowedFields.includes(key)) {
        // Basic sanitization
        if (typeof body[key] === 'string') {
          sanitized[key] = body[key].trim();
        } else {
          sanitized[key] = body[key];
        }
      }
    });
    return sanitized;
  }

  /**
   * Get pagination parameters from query
   * @param {Object} query - Request query object
   * @returns {Object} Pagination parameters
   */
  getPaginationParams(query) {
    const page = Math.max(1, parseInt(query.page, 10) || 1);
    const limit = Math.min(100, Math.max(1, parseInt(query.limit, 10) || 10));
    const skip = (page - 1) * limit;
    return {
      page,
      limit,
      skip
    };
  }

  /**
   * Get sorting parameters from query
   * @param {Object} query - Request query object
   * @param {Array<string>} allowedFields - Allowed sort fields
   * @param {string} defaultSort - Default sort field
   * @returns {Object} Sort parameters
   */
  getSortParams(query, allowedFields = [], defaultSort = 'createdAt') {
    const sortBy = query.sortBy || defaultSort;
    const sortOrder = query.sortOrder === 'asc' ? 1 : -1;

    // Validate sort field
    if (allowedFields.length > 0 && !allowedFields.includes(sortBy)) {
      throw new ValidationError(`Invalid sort field. Allowed fields: ${allowedFields.join(', ')}`, {
        allowedFields,
        providedField: sortBy
      });
    }
    return {
      sortBy,
      sortOrder
    };
  }

  /**
   * Get filter parameters from query
   * @param {Object} query - Request query object
   * @param {Array<string>} allowedFilters - Allowed filter fields
   * @returns {Object} Filter parameters
   */
  getFilterParams(query, allowedFilters = []) {
    const filters = {};
    allowedFilters.forEach(field => {
      if (query[field] !== undefined && query[field] !== '') {
        filters[field] = query[field];
      }
    });
    return filters;
  }

  /**
   * Handle service method execution
   * @param {Function} serviceMethod - Service method to execute
   * @param {Array} args - Arguments to pass to service method
   * @returns {Function} Express middleware function
   */
  handleService(serviceMethod, ...args) {
    return asyncHandler(async (req, res, next) => {
      try {
        const result = await serviceMethod(...args);
        this.sendSuccess(res, result);
      } catch (error) {
        next(error);
      }
    });
  }

  /**
   * Handle service method with custom response
   * @param {Function} serviceMethod - Service method to execute
   * @param {Function} responseHandler - Custom response handler
   * @param {Array} args - Arguments to pass to service method
   * @returns {Function} Express middleware function
   */
  handleServiceWithResponse(serviceMethod, responseHandler, ...args) {
    return asyncHandler(async (req, res, next) => {
      try {
        const result = await serviceMethod(...args);
        responseHandler(res, result);
      } catch (error) {
        next(error);
      }
    });
  }

  /**
   * Create CRUD operations for a service
   * @param {Object} service - Service instance
   * @param {string} resourceName - Name of the resource
   * @returns {Object} CRUD operation methods
   */
  createCRUDOperations(service, resourceName) {
    return {
      // Get all resources
      getAll: asyncHandler(async (req, res, next) => {
        try {
          const {
            page,
            limit,
            skip
          } = this.getPaginationParams(req.query);
          const filters = this.getFilterParams(req.query, service.getAllowedFilters?.() || []);
          const {
            sortBy,
            sortOrder
          } = this.getSortParams(req.query, service.getAllowedSortFields?.() || []);
          const result = await service.getAll({
            page,
            limit,
            skip,
            filters,
            sort: {
              [sortBy]: sortOrder
            }
          });
          this.sendPaginated(res, result.data, page, limit, result.total);
        } catch (error) {
          next(error);
        }
      }),
      // Get resource by ID
      getById: asyncHandler(async (req, res, next) => {
        try {
          this.validateRequestParams(req.params, ['id']);
          const result = await service.getById(req.params.id);
          this.sendSuccess(res, result);
        } catch (error) {
          next(error);
        }
      }),
      // Create new resource
      create: asyncHandler(async (req, res, next) => {
        try {
          const sanitizedBody = this.sanitizeRequestBody(req.body, service.getAllowedFields?.() || []);
          const result = await service.create(sanitizedBody);
          this.sendSuccess(res, result, `${resourceName} created successfully`, 201);
        } catch (error) {
          next(error);
        }
      }),
      // Update resource
      update: asyncHandler(async (req, res, next) => {
        try {
          this.validateRequestParams(req.params, ['id']);
          const sanitizedBody = this.sanitizeRequestBody(req.body, service.getAllowedFields?.() || []);
          const result = await service.update(req.params.id, sanitizedBody);
          this.sendSuccess(res, result, `${resourceName} updated successfully`);
        } catch (error) {
          next(error);
        }
      }),
      // Delete resource
      delete: asyncHandler(async (req, res, next) => {
        try {
          this.validateRequestParams(req.params, ['id']);
          await service.delete(req.params.id);
          this.sendSuccess(res, null, `${resourceName} deleted successfully`, 204);
        } catch (error) {
          next(error);
        }
      })
    };
  }
}
module.exports = BaseController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzdWNjZXNzUmVzcG9uc2UiLCJwYWdpbmF0ZWRSZXNwb25zZSIsInJlcXVpcmUiLCJhc3luY0hhbmRsZXIiLCJWYWxpZGF0aW9uRXJyb3IiLCJCYXNlQ29udHJvbGxlciIsInNlbmRTdWNjZXNzIiwicmVzIiwiZGF0YSIsIm1lc3NhZ2UiLCJzdGF0dXNDb2RlIiwic3RhdHVzIiwianNvbiIsInNlbmRQYWdpbmF0ZWQiLCJwYWdlIiwibGltaXQiLCJ0b3RhbCIsInZhbGlkYXRlUmVxdWVzdEJvZHkiLCJib2R5IiwicmVxdWlyZWRGaWVsZHMiLCJtaXNzaW5nRmllbGRzIiwiZmlsdGVyIiwiZmllbGQiLCJ1bmRlZmluZWQiLCJsZW5ndGgiLCJqb2luIiwidmFsaWRhdGVSZXF1ZXN0UGFyYW1zIiwicGFyYW1zIiwicmVxdWlyZWRQYXJhbXMiLCJtaXNzaW5nUGFyYW1zIiwicGFyYW0iLCJzYW5pdGl6ZVJlcXVlc3RCb2R5IiwiYWxsb3dlZEZpZWxkcyIsInNhbml0aXplZCIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwia2V5IiwiaW5jbHVkZXMiLCJ0cmltIiwiZ2V0UGFnaW5hdGlvblBhcmFtcyIsInF1ZXJ5IiwiTWF0aCIsIm1heCIsInBhcnNlSW50IiwibWluIiwic2tpcCIsImdldFNvcnRQYXJhbXMiLCJkZWZhdWx0U29ydCIsInNvcnRCeSIsInNvcnRPcmRlciIsInByb3ZpZGVkRmllbGQiLCJnZXRGaWx0ZXJQYXJhbXMiLCJhbGxvd2VkRmlsdGVycyIsImZpbHRlcnMiLCJoYW5kbGVTZXJ2aWNlIiwic2VydmljZU1ldGhvZCIsImFyZ3MiLCJyZXEiLCJuZXh0IiwicmVzdWx0IiwiZXJyb3IiLCJoYW5kbGVTZXJ2aWNlV2l0aFJlc3BvbnNlIiwicmVzcG9uc2VIYW5kbGVyIiwiY3JlYXRlQ1JVRE9wZXJhdGlvbnMiLCJzZXJ2aWNlIiwicmVzb3VyY2VOYW1lIiwiZ2V0QWxsIiwiZ2V0QWxsb3dlZEZpbHRlcnMiLCJnZXRBbGxvd2VkU29ydEZpZWxkcyIsInNvcnQiLCJnZXRCeUlkIiwiaWQiLCJjcmVhdGUiLCJzYW5pdGl6ZWRCb2R5IiwiZ2V0QWxsb3dlZEZpZWxkcyIsInVwZGF0ZSIsImRlbGV0ZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJiYXNlLmNvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBzdWNjZXNzUmVzcG9uc2UsIHBhZ2luYXRlZFJlc3BvbnNlIH0gPSByZXF1aXJlKCcuLi91dGlscy9yZXNwb25zZScpO1xuY29uc3QgeyBhc3luY0hhbmRsZXIgfSA9IHJlcXVpcmUoJy4uL3V0aWxzL2FzeW5jSGFuZGxlcicpO1xuY29uc3QgeyBWYWxpZGF0aW9uRXJyb3IgfSA9IHJlcXVpcmUoJy4uL3V0aWxzL2Vycm9ycycpO1xuXG4vKipcbiAqIEJhc2UgY29udHJvbGxlciBjbGFzcyB3aXRoIGNvbW1vbiBmdW5jdGlvbmFsaXR5XG4gKi9cbmNsYXNzIEJhc2VDb250cm9sbGVyIHtcbiAgLyoqXG4gICAqIFNlbmQgc3VjY2VzcyByZXNwb25zZVxuICAgKiBAcGFyYW0ge09iamVjdH0gcmVzIC0gRXhwcmVzcyByZXNwb25zZSBvYmplY3RcbiAgICogQHBhcmFtIHsqfSBkYXRhIC0gUmVzcG9uc2UgZGF0YVxuICAgKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIFN1Y2Nlc3MgbWVzc2FnZVxuICAgKiBAcGFyYW0ge251bWJlcn0gc3RhdHVzQ29kZSAtIEhUVFAgc3RhdHVzIGNvZGVcbiAgICovXG4gIHNlbmRTdWNjZXNzKHJlcywgZGF0YSA9IG51bGwsIG1lc3NhZ2UgPSAnU3VjY2VzcycsIHN0YXR1c0NvZGUgPSAyMDApIHtcbiAgICByZXMuc3RhdHVzKHN0YXR1c0NvZGUpLmpzb24oc3VjY2Vzc1Jlc3BvbnNlKGRhdGEsIG1lc3NhZ2UpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIHBhZ2luYXRlZCByZXNwb25zZVxuICAgKiBAcGFyYW0ge09iamVjdH0gcmVzIC0gRXhwcmVzcyByZXNwb25zZSBvYmplY3RcbiAgICogQHBhcmFtIHtBcnJheX0gZGF0YSAtIFJlc3BvbnNlIGRhdGFcbiAgICogQHBhcmFtIHtudW1iZXJ9IHBhZ2UgLSBDdXJyZW50IHBhZ2VcbiAgICogQHBhcmFtIHtudW1iZXJ9IGxpbWl0IC0gSXRlbXMgcGVyIHBhZ2VcbiAgICogQHBhcmFtIHtudW1iZXJ9IHRvdGFsIC0gVG90YWwgaXRlbXNcbiAgICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSBTdWNjZXNzIG1lc3NhZ2VcbiAgICovXG4gIHNlbmRQYWdpbmF0ZWQocmVzLCBkYXRhLCBwYWdlLCBsaW1pdCwgdG90YWwpIHtcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbihwYWdpbmF0ZWRSZXNwb25zZShkYXRhLCBwYWdlLCBsaW1pdCwgdG90YWwpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSByZXF1ZXN0IGJvZHlcbiAgICogQHBhcmFtIHtPYmplY3R9IGJvZHkgLSBSZXF1ZXN0IGJvZHlcbiAgICogQHBhcmFtIHtBcnJheTxzdHJpbmc+fSByZXF1aXJlZEZpZWxkcyAtIFJlcXVpcmVkIGZpZWxkIG5hbWVzXG4gICAqIEB0aHJvd3Mge1ZhbGlkYXRpb25FcnJvcn0gSWYgdmFsaWRhdGlvbiBmYWlsc1xuICAgKi9cbiAgdmFsaWRhdGVSZXF1ZXN0Qm9keShib2R5LCByZXF1aXJlZEZpZWxkcykge1xuICAgIGNvbnN0IG1pc3NpbmdGaWVsZHMgPSByZXF1aXJlZEZpZWxkcy5maWx0ZXIoZmllbGQgPT5cbiAgICAgIGJvZHlbZmllbGRdID09PSB1bmRlZmluZWQgfHwgYm9keVtmaWVsZF0gPT09IG51bGwgfHwgYm9keVtmaWVsZF0gPT09ICcnXG4gICAgKTtcblxuICAgIGlmIChtaXNzaW5nRmllbGRzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoXG4gICAgICAgIGBNaXNzaW5nIHJlcXVpcmVkIGZpZWxkczogJHttaXNzaW5nRmllbGRzLmpvaW4oJywgJyl9YCxcbiAgICAgICAgeyBtaXNzaW5nRmllbGRzIH1cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIHJlcXVlc3QgcGFyYW1ldGVyc1xuICAgKiBAcGFyYW0ge09iamVjdH0gcGFyYW1zIC0gUmVxdWVzdCBwYXJhbWV0ZXJzXG4gICAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gcmVxdWlyZWRQYXJhbXMgLSBSZXF1aXJlZCBwYXJhbWV0ZXIgbmFtZXNcbiAgICogQHRocm93cyB7VmFsaWRhdGlvbkVycm9yfSBJZiB2YWxpZGF0aW9uIGZhaWxzXG4gICAqL1xuICB2YWxpZGF0ZVJlcXVlc3RQYXJhbXMocGFyYW1zLCByZXF1aXJlZFBhcmFtcykge1xuICAgIGNvbnN0IG1pc3NpbmdQYXJhbXMgPSByZXF1aXJlZFBhcmFtcy5maWx0ZXIocGFyYW0gPT5cbiAgICAgICFwYXJhbXNbcGFyYW1dIHx8IHBhcmFtc1twYXJhbV0gPT09ICcnXG4gICAgKTtcblxuICAgIGlmIChtaXNzaW5nUGFyYW1zLmxlbmd0aCA+IDApIHtcbiAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoXG4gICAgICAgIGBNaXNzaW5nIHJlcXVpcmVkIHBhcmFtZXRlcnM6ICR7bWlzc2luZ1BhcmFtcy5qb2luKCcsICcpfWAsXG4gICAgICAgIHsgbWlzc2luZ1BhcmFtcyB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTYW5pdGl6ZSByZXF1ZXN0IGJvZHlcbiAgICogQHBhcmFtIHtPYmplY3R9IGJvZHkgLSBSZXF1ZXN0IGJvZHlcbiAgICogQHBhcmFtIHtBcnJheTxzdHJpbmc+fSBhbGxvd2VkRmllbGRzIC0gQWxsb3dlZCBmaWVsZCBuYW1lc1xuICAgKiBAcmV0dXJucyB7T2JqZWN0fSBTYW5pdGl6ZWQgYm9keVxuICAgKi9cbiAgc2FuaXRpemVSZXF1ZXN0Qm9keShib2R5LCBhbGxvd2VkRmllbGRzKSB7XG4gICAgY29uc3Qgc2FuaXRpemVkID0ge307XG5cbiAgICBPYmplY3Qua2V5cyhib2R5KS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICBpZiAoYWxsb3dlZEZpZWxkcy5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICAgIC8vIEJhc2ljIHNhbml0aXphdGlvblxuICAgICAgICBpZiAodHlwZW9mIGJvZHlba2V5XSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICBzYW5pdGl6ZWRba2V5XSA9IGJvZHlba2V5XS50cmltKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2FuaXRpemVkW2tleV0gPSBib2R5W2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBzYW5pdGl6ZWQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHBhZ2luYXRpb24gcGFyYW1ldGVycyBmcm9tIHF1ZXJ5XG4gICAqIEBwYXJhbSB7T2JqZWN0fSBxdWVyeSAtIFJlcXVlc3QgcXVlcnkgb2JqZWN0XG4gICAqIEByZXR1cm5zIHtPYmplY3R9IFBhZ2luYXRpb24gcGFyYW1ldGVyc1xuICAgKi9cbiAgZ2V0UGFnaW5hdGlvblBhcmFtcyhxdWVyeSkge1xuICAgIGNvbnN0IHBhZ2UgPSBNYXRoLm1heCgxLCBwYXJzZUludChxdWVyeS5wYWdlLCAxMCkgfHwgMSk7XG4gICAgY29uc3QgbGltaXQgPSBNYXRoLm1pbigxMDAsIE1hdGgubWF4KDEsIHBhcnNlSW50KHF1ZXJ5LmxpbWl0LCAxMCkgfHwgMTApKTtcbiAgICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xuXG4gICAgcmV0dXJuIHsgcGFnZSwgbGltaXQsIHNraXAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc29ydGluZyBwYXJhbWV0ZXJzIGZyb20gcXVlcnlcbiAgICogQHBhcmFtIHtPYmplY3R9IHF1ZXJ5IC0gUmVxdWVzdCBxdWVyeSBvYmplY3RcbiAgICogQHBhcmFtIHtBcnJheTxzdHJpbmc+fSBhbGxvd2VkRmllbGRzIC0gQWxsb3dlZCBzb3J0IGZpZWxkc1xuICAgKiBAcGFyYW0ge3N0cmluZ30gZGVmYXVsdFNvcnQgLSBEZWZhdWx0IHNvcnQgZmllbGRcbiAgICogQHJldHVybnMge09iamVjdH0gU29ydCBwYXJhbWV0ZXJzXG4gICAqL1xuICBnZXRTb3J0UGFyYW1zKHF1ZXJ5LCBhbGxvd2VkRmllbGRzID0gW10sIGRlZmF1bHRTb3J0ID0gJ2NyZWF0ZWRBdCcpIHtcbiAgICBjb25zdCBzb3J0QnkgPSBxdWVyeS5zb3J0QnkgfHwgZGVmYXVsdFNvcnQ7XG4gICAgY29uc3Qgc29ydE9yZGVyID0gcXVlcnkuc29ydE9yZGVyID09PSAnYXNjJyA/IDEgOiAtMTtcblxuICAgIC8vIFZhbGlkYXRlIHNvcnQgZmllbGRcbiAgICBpZiAoYWxsb3dlZEZpZWxkcy5sZW5ndGggPiAwICYmICFhbGxvd2VkRmllbGRzLmluY2x1ZGVzKHNvcnRCeSkpIHtcbiAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoXG4gICAgICAgIGBJbnZhbGlkIHNvcnQgZmllbGQuIEFsbG93ZWQgZmllbGRzOiAke2FsbG93ZWRGaWVsZHMuam9pbignLCAnKX1gLFxuICAgICAgICB7IGFsbG93ZWRGaWVsZHMsIHByb3ZpZGVkRmllbGQ6IHNvcnRCeSB9XG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiB7IHNvcnRCeSwgc29ydE9yZGVyIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGZpbHRlciBwYXJhbWV0ZXJzIGZyb20gcXVlcnlcbiAgICogQHBhcmFtIHtPYmplY3R9IHF1ZXJ5IC0gUmVxdWVzdCBxdWVyeSBvYmplY3RcbiAgICogQHBhcmFtIHtBcnJheTxzdHJpbmc+fSBhbGxvd2VkRmlsdGVycyAtIEFsbG93ZWQgZmlsdGVyIGZpZWxkc1xuICAgKiBAcmV0dXJucyB7T2JqZWN0fSBGaWx0ZXIgcGFyYW1ldGVyc1xuICAgKi9cbiAgZ2V0RmlsdGVyUGFyYW1zKHF1ZXJ5LCBhbGxvd2VkRmlsdGVycyA9IFtdKSB7XG4gICAgY29uc3QgZmlsdGVycyA9IHt9O1xuXG4gICAgYWxsb3dlZEZpbHRlcnMuZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgICBpZiAocXVlcnlbZmllbGRdICE9PSB1bmRlZmluZWQgJiYgcXVlcnlbZmllbGRdICE9PSAnJykge1xuICAgICAgICBmaWx0ZXJzW2ZpZWxkXSA9IHF1ZXJ5W2ZpZWxkXTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBmaWx0ZXJzO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBzZXJ2aWNlIG1ldGhvZCBleGVjdXRpb25cbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gc2VydmljZU1ldGhvZCAtIFNlcnZpY2UgbWV0aG9kIHRvIGV4ZWN1dGVcbiAgICogQHBhcmFtIHtBcnJheX0gYXJncyAtIEFyZ3VtZW50cyB0byBwYXNzIHRvIHNlcnZpY2UgbWV0aG9kXG4gICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gRXhwcmVzcyBtaWRkbGV3YXJlIGZ1bmN0aW9uXG4gICAqL1xuICBoYW5kbGVTZXJ2aWNlKHNlcnZpY2VNZXRob2QsIC4uLmFyZ3MpIHtcbiAgICByZXR1cm4gYXN5bmNIYW5kbGVyKGFzeW5jKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlTWV0aG9kKC4uLmFyZ3MpO1xuICAgICAgICB0aGlzLnNlbmRTdWNjZXNzKHJlcywgcmVzdWx0KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIG5leHQoZXJyb3IpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBzZXJ2aWNlIG1ldGhvZCB3aXRoIGN1c3RvbSByZXNwb25zZVxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzZXJ2aWNlTWV0aG9kIC0gU2VydmljZSBtZXRob2QgdG8gZXhlY3V0ZVxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSByZXNwb25zZUhhbmRsZXIgLSBDdXN0b20gcmVzcG9uc2UgaGFuZGxlclxuICAgKiBAcGFyYW0ge0FycmF5fSBhcmdzIC0gQXJndW1lbnRzIHRvIHBhc3MgdG8gc2VydmljZSBtZXRob2RcbiAgICogQHJldHVybnMge0Z1bmN0aW9ufSBFeHByZXNzIG1pZGRsZXdhcmUgZnVuY3Rpb25cbiAgICovXG4gIGhhbmRsZVNlcnZpY2VXaXRoUmVzcG9uc2Uoc2VydmljZU1ldGhvZCwgcmVzcG9uc2VIYW5kbGVyLCAuLi5hcmdzKSB7XG4gICAgcmV0dXJuIGFzeW5jSGFuZGxlcihhc3luYyhyZXEsIHJlcywgbmV4dCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZU1ldGhvZCguLi5hcmdzKTtcbiAgICAgICAgcmVzcG9uc2VIYW5kbGVyKHJlcywgcmVzdWx0KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIG5leHQoZXJyb3IpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBDUlVEIG9wZXJhdGlvbnMgZm9yIGEgc2VydmljZVxuICAgKiBAcGFyYW0ge09iamVjdH0gc2VydmljZSAtIFNlcnZpY2UgaW5zdGFuY2VcbiAgICogQHBhcmFtIHtzdHJpbmd9IHJlc291cmNlTmFtZSAtIE5hbWUgb2YgdGhlIHJlc291cmNlXG4gICAqIEByZXR1cm5zIHtPYmplY3R9IENSVUQgb3BlcmF0aW9uIG1ldGhvZHNcbiAgICovXG4gIGNyZWF0ZUNSVURPcGVyYXRpb25zKHNlcnZpY2UsIHJlc291cmNlTmFtZSkge1xuICAgIHJldHVybiB7XG4gICAgICAvLyBHZXQgYWxsIHJlc291cmNlc1xuICAgICAgZ2V0QWxsOiBhc3luY0hhbmRsZXIoYXN5bmMocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCB7IHBhZ2UsIGxpbWl0LCBza2lwIH0gPSB0aGlzLmdldFBhZ2luYXRpb25QYXJhbXMocmVxLnF1ZXJ5KTtcbiAgICAgICAgICBjb25zdCBmaWx0ZXJzID0gdGhpcy5nZXRGaWx0ZXJQYXJhbXMocmVxLnF1ZXJ5LCBzZXJ2aWNlLmdldEFsbG93ZWRGaWx0ZXJzPy4oKSB8fCBbXSk7XG4gICAgICAgICAgY29uc3QgeyBzb3J0QnksIHNvcnRPcmRlciB9ID0gdGhpcy5nZXRTb3J0UGFyYW1zKHJlcS5xdWVyeSwgc2VydmljZS5nZXRBbGxvd2VkU29ydEZpZWxkcz8uKCkgfHwgW10pO1xuXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5nZXRBbGwoe1xuICAgICAgICAgICAgcGFnZSxcbiAgICAgICAgICAgIGxpbWl0LFxuICAgICAgICAgICAgc2tpcCxcbiAgICAgICAgICAgIGZpbHRlcnMsXG4gICAgICAgICAgICBzb3J0OiB7IFtzb3J0QnldOiBzb3J0T3JkZXIgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGhpcy5zZW5kUGFnaW5hdGVkKHJlcywgcmVzdWx0LmRhdGEsIHBhZ2UsIGxpbWl0LCByZXN1bHQudG90YWwpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIG5leHQoZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9KSxcblxuICAgICAgLy8gR2V0IHJlc291cmNlIGJ5IElEXG4gICAgICBnZXRCeUlkOiBhc3luY0hhbmRsZXIoYXN5bmMocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB0aGlzLnZhbGlkYXRlUmVxdWVzdFBhcmFtcyhyZXEucGFyYW1zLCBbJ2lkJ10pO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0QnlJZChyZXEucGFyYW1zLmlkKTtcbiAgICAgICAgICB0aGlzLnNlbmRTdWNjZXNzKHJlcywgcmVzdWx0KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBuZXh0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSksXG5cbiAgICAgIC8vIENyZWF0ZSBuZXcgcmVzb3VyY2VcbiAgICAgIGNyZWF0ZTogYXN5bmNIYW5kbGVyKGFzeW5jKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3Qgc2FuaXRpemVkQm9keSA9IHRoaXMuc2FuaXRpemVSZXF1ZXN0Qm9keShyZXEuYm9keSwgc2VydmljZS5nZXRBbGxvd2VkRmllbGRzPy4oKSB8fCBbXSk7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5jcmVhdGUoc2FuaXRpemVkQm9keSk7XG4gICAgICAgICAgdGhpcy5zZW5kU3VjY2VzcyhyZXMsIHJlc3VsdCwgYCR7cmVzb3VyY2VOYW1lfSBjcmVhdGVkIHN1Y2Nlc3NmdWxseWAsIDIwMSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgbmV4dChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0pLFxuXG4gICAgICAvLyBVcGRhdGUgcmVzb3VyY2VcbiAgICAgIHVwZGF0ZTogYXN5bmNIYW5kbGVyKGFzeW5jKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdGhpcy52YWxpZGF0ZVJlcXVlc3RQYXJhbXMocmVxLnBhcmFtcywgWydpZCddKTtcbiAgICAgICAgICBjb25zdCBzYW5pdGl6ZWRCb2R5ID0gdGhpcy5zYW5pdGl6ZVJlcXVlc3RCb2R5KHJlcS5ib2R5LCBzZXJ2aWNlLmdldEFsbG93ZWRGaWVsZHM/LigpIHx8IFtdKTtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnVwZGF0ZShyZXEucGFyYW1zLmlkLCBzYW5pdGl6ZWRCb2R5KTtcbiAgICAgICAgICB0aGlzLnNlbmRTdWNjZXNzKHJlcywgcmVzdWx0LCBgJHtyZXNvdXJjZU5hbWV9IHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgbmV4dChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0pLFxuXG4gICAgICAvLyBEZWxldGUgcmVzb3VyY2VcbiAgICAgIGRlbGV0ZTogYXN5bmNIYW5kbGVyKGFzeW5jKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdGhpcy52YWxpZGF0ZVJlcXVlc3RQYXJhbXMocmVxLnBhcmFtcywgWydpZCddKTtcbiAgICAgICAgICBhd2FpdCBzZXJ2aWNlLmRlbGV0ZShyZXEucGFyYW1zLmlkKTtcbiAgICAgICAgICB0aGlzLnNlbmRTdWNjZXNzKHJlcywgbnVsbCwgYCR7cmVzb3VyY2VOYW1lfSBkZWxldGVkIHN1Y2Nlc3NmdWxseWAsIDIwNCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgbmV4dChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEJhc2VDb250cm9sbGVyOyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTTtFQUFFQSxlQUFlO0VBQUVDO0FBQWtCLENBQUMsR0FBR0MsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQzNFLE1BQU07RUFBRUM7QUFBYSxDQUFDLEdBQUdELE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQztBQUN6RCxNQUFNO0VBQUVFO0FBQWdCLENBQUMsR0FBR0YsT0FBTyxDQUFDLGlCQUFpQixDQUFDOztBQUV0RDtBQUNBO0FBQ0E7QUFDQSxNQUFNRyxjQUFjLENBQUM7RUFDbkI7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDRUMsV0FBV0EsQ0FBQ0MsR0FBRyxFQUFFQyxJQUFJLEdBQUcsSUFBSSxFQUFFQyxPQUFPLEdBQUcsU0FBUyxFQUFFQyxVQUFVLEdBQUcsR0FBRyxFQUFFO0lBQ25FSCxHQUFHLENBQUNJLE1BQU0sQ0FBQ0QsVUFBVSxDQUFDLENBQUNFLElBQUksQ0FBQ1osZUFBZSxDQUFDUSxJQUFJLEVBQUVDLE9BQU8sQ0FBQyxDQUFDO0VBQzdEOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNFSSxhQUFhQSxDQUFDTixHQUFHLEVBQUVD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