435832c84ea8536e76b71053d1cf460d
const dotenv = require('dotenv');
const path = require('path');
const {
  validateEnvironment
} = require('../utils/envValidator');

// Load environment variables based on NODE_ENV
const envFile = process.env.NODE_ENV === 'production' ? '.env.prod' : process.env.NODE_ENV === 'test' ? '.env.test' : '.env';
dotenv.config({
  path: path.resolve(process.cwd(), envFile)
});

// Validate environment variables
validateEnvironment();

// Configuration object
const config = {
  // Server configuration
  server: {
    port: parseInt(process.env.PORT, 10) || 8000,
    host: process.env.HOST || '0.0.0.0',
    nodeEnv: process.env.NODE_ENV || 'development',
    isDevelopment: process.env.NODE_ENV === 'development' || process.env.NODE_ENV === 'test',
    isProduction: process.env.NODE_ENV === 'production',
    isTest: process.env.NODE_ENV === 'test'
  },
  // Database configuration
  database: {
    uri: process.env.MONGODB_URI,
    options: {
      maxPoolSize: parseInt(process.env.DB_MAX_POOL_SIZE, 10) || 10,
      serverSelectionTimeoutMS: parseInt(process.env.DB_SERVER_SELECTION_TIMEOUT, 10) || 5000,
      socketTimeoutMS: parseInt(process.env.DB_SOCKET_TIMEOUT, 10) || 45000
    }
  },
  // Redis configuration
  redis: {
    url: process.env.REDIS_URL || 'redis://localhost:6379',
    password: process.env.REDIS_PASSWORD,
    retryDelayOnFailover: 100,
    maxRetriesPerRequest: 3,
    lazyConnect: true,
    keepAlive: 30000,
    connectTimeout: 10000,
    commandTimeout: 5000
  },
  // JWT configuration
  jwt: {
    secret: process.env.JWT_SECRET,
    expiresIn: process.env.JWT_EXPIRES_IN || '7d',
    issuer: process.env.JWT_ISSUER || 'tripvar',
    audience: process.env.JWT_AUDIENCE || 'tripvar-users'
  },
  // Security configuration
  security: {
    allowedOrigins: process.env.ALLOWED_ORIGINS ? process.env.ALLOWED_ORIGINS.split(',') : ['http://localhost:5173', 'http://localhost:3000'],
    corsCredentials: process.env.CORS_CREDENTIALS === 'true',
    rateLimitWindowMs: parseInt(process.env.RATE_LIMIT_WINDOW_MS, 10) || 900000,
    // 15 minutes
    rateLimitMaxRequests: parseInt(process.env.RATE_LIMIT_MAX_REQUESTS, 10) || 100,
    authRateLimitMaxRequests: parseInt(process.env.AUTH_RATE_LIMIT_MAX_REQUESTS, 10) || 5,
    bcryptRounds: parseInt(process.env.BCRYPT_ROUNDS, 10) || 12
  },
  // Logging configuration
  logging: {
    level: process.env.LOG_LEVEL || 'info',
    filePath: process.env.LOG_FILE_PATH || './logs/app.log',
    maxSize: process.env.LOG_MAX_SIZE || '20m',
    maxFiles: parseInt(process.env.LOG_MAX_FILES, 10) || 5,
    datePattern: process.env.LOG_DATE_PATTERN || 'YYYY-MM-DD'
  },
  // SSL/TLS configuration
  ssl: {
    enabled: process.env.SSL_ENABLED === 'true',
    certPath: process.env.SSL_CERT_PATH,
    keyPath: process.env.SSL_KEY_PATH
  },
  // Monitoring configuration
  monitoring: {
    healthCheckInterval: parseInt(process.env.HEALTH_CHECK_INTERVAL, 10) || 30000,
    metricsEnabled: process.env.METRICS_ENABLED === 'true',
    sentryDsn: process.env.SENTRY_DSN
  },
  // File upload configuration
  upload: {
    maxFileSize: parseInt(process.env.MAX_FILE_SIZE, 10) || 10485760,
    // 10MB
    uploadPath: process.env.UPLOAD_PATH || './uploads',
    allowedMimeTypes: process.env.ALLOWED_MIME_TYPES ? process.env.ALLOWED_MIME_TYPES.split(',') : ['image/jpeg', 'image/png', 'image/gif', 'image/webp']
  },
  // Email configuration
  email: {
    smtpHost: process.env.SMTP_HOST,
    smtpPort: parseInt(process.env.SMTP_PORT, 10) || 587,
    smtpUser: process.env.SMTP_USER,
    smtpPass: process.env.SMTP_PASS,
    fromEmail: process.env.FROM_EMAIL || 'noreply@tripvar.com'
  },
  // External APIs configuration
  externalApis: {
    timeout: parseInt(process.env.EXTERNAL_API_TIMEOUT, 10) || 10000,
    retries: parseInt(process.env.EXTERNAL_API_RETRIES, 10) || 3,
    googleMapsApiKey: process.env.GOOGLE_MAPS_API_KEY,
    stripeSecretKey: process.env.STRIPE_SECRET_KEY
  }
};

// Validate configuration
const validateConfig = () => {
  const errors = [];

  // Validate JWT secret strength
  if (config.jwt.secret && config.jwt.secret.length < 32) {
    errors.push('JWT_SECRET must be at least 32 characters long');
  }

  // Validate MongoDB URI format
  if (!config.database.uri.startsWith('mongodb://') && !config.database.uri.startsWith('mongodb+srv://')) {
    errors.push('MONGODB_URI must be a valid MongoDB connection string');
  }

  // Validate SSL configuration in production
  if (config.server.isProduction && config.ssl.enabled) {
    if (!config.ssl.certPath || !config.ssl.keyPath) {
      errors.push('SSL certificate and key paths must be provided in production');
    }
  }
  if (errors.length > 0) {
    // Use process.stderr for critical startup errors before logger is available
    process.stderr.write('Configuration validation errors:\n');
    errors.forEach(error => process.stderr.write(`- ${error}\n`));
    throw new Error('Configuration validation failed');
  }
};

// Run validation
validateConfig();
module.exports = config;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkb3RlbnYiLCJyZXF1aXJlIiwicGF0aCIsInZhbGlkYXRlRW52aXJvbm1lbnQiLCJlbnZGaWxlIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiY29uZmlnIiwicmVzb2x2ZSIsImN3ZCIsInNlcnZlciIsInBvcnQiLCJwYXJzZUludCIsIlBPUlQiLCJob3N0IiwiSE9TVCIsIm5vZGVFbnYiLCJpc0RldmVsb3BtZW50IiwiaXNQcm9kdWN0aW9uIiwiaXNUZXN0IiwiZGF0YWJhc2UiLCJ1cmkiLCJNT05HT0RCX1VSSSIsIm9wdGlvbnMiLCJtYXhQb29sU2l6ZSIsIkRCX01BWF9QT09MX1NJWkUiLCJzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMiLCJEQl9TRVJWRVJfU0VMRUNUSU9OX1RJTUVPVVQiLCJzb2NrZXRUaW1lb3V0TVMiLCJEQl9TT0NLRVRfVElNRU9VVCIsInJlZGlzIiwidXJsIiwiUkVESVNfVVJMIiwicGFzc3dvcmQiLCJSRURJU19QQVNTV09SRCIsInJldHJ5RGVsYXlPbkZhaWxvdmVyIiwibWF4UmV0cmllc1BlclJlcXVlc3QiLCJsYXp5Q29ubmVjdCIsImtlZXBBbGl2ZSIsImNvbm5lY3RUaW1lb3V0IiwiY29tbWFuZFRpbWVvdXQiLCJqd3QiLCJzZWNyZXQiLCJKV1RfU0VDUkVUIiwiZXhwaXJlc0luIiwiSldUX0VYUElSRVNfSU4iLCJpc3N1ZXIiLCJKV1RfSVNTVUVSIiwiYXVkaWVuY2UiLCJKV1RfQVVESUVOQ0UiLCJzZWN1cml0eSIsImFsbG93ZWRPcmlnaW5zIiwiQUxMT1dFRF9PUklHSU5TIiwic3BsaXQiLCJjb3JzQ3JlZGVudGlhbHMiLCJDT1JTX0NSRURFTlRJQUxTIiwicmF0ZUxpbWl0V2luZG93TXMiLCJSQVRFX0xJTUlUX1dJTkRPV19NUyIsInJhdGVMaW1pdE1heFJlcXVlc3RzIiwiUkFURV9MSU1JVF9NQVhfUkVRVUVTVFMiLCJhdXRoUmF0ZUxpbWl0TWF4UmVxdWVzdHMiLCJBVVRIX1JBVEVfTElNSVRfTUFYX1JFUVVFU1RTIiwiYmNyeXB0Um91bmRzIiwiQkNSWVBUX1JPVU5EUyIsImxvZ2dpbmciLCJsZXZlbCIsIkxPR19MRVZFTCIsImZpbGVQYXRoIiwiTE9HX0ZJTEVfUEFUSCIsIm1heFNpemUiLCJMT0dfTUFYX1NJWkUiLCJtYXhGaWxlcyIsIkxPR19NQVhfRklMRVMiLCJkYXRlUGF0dGVybiIsIkxPR19EQVRFX1BBVFRFUk4iLCJzc2wiLCJlbmFibGVkIiwiU1NMX0VOQUJMRUQiLCJjZXJ0UGF0aCIsIlNTTF9DRVJUX1BBVEgiLCJrZXlQYXRoIiwiU1NMX0tFWV9QQVRIIiwibW9uaXRvcmluZyIsImhlYWx0aENoZWNrSW50ZXJ2YWwiLCJIRUFMVEhfQ0hFQ0tfSU5URVJWQUwiLCJtZXRyaWNzRW5hYmxlZCIsIk1FVFJJQ1NfRU5BQkxFRCIsInNlbnRyeURzbiIsIlNFTlRSWV9EU04iLCJ1cGxvYWQiLCJtYXhGaWxlU2l6ZSIsIk1BWF9GSUxFX1NJWkUiLCJ1cGxvYWRQYXRoIiwiVVBMT0FEX1BBVEgiLCJhbGxvd2VkTWltZVR5cGVzIiwiQUxMT1dFRF9NSU1FX1RZUEVTIiwiZW1haWwiLCJzbXRwSG9zdCIsIlNNVFBfSE9TVCIsInNtdHBQb3J0IiwiU01UUF9QT1JUIiwic210cFVzZXIiLCJTTVRQX1VTRVIiLCJzbXRwUGFzcyIsIlNNVFBfUEFTUyIsImZyb21FbWFpbCIsIkZST01fRU1BSUwiLCJleHRlcm5hbEFwaXMiLCJ0aW1lb3V0IiwiRVhURVJOQUxfQVBJX1RJTUVPVVQiLCJyZXRyaWVzIiwiRVhURVJOQUxfQVBJX1JFVFJJRVMiLCJnb29nbGVNYXBzQXBpS2V5IiwiR09PR0xFX01BUFNfQVBJX0tFWSIsInN0cmlwZVNlY3JldEtleSIsIlNUUklQRV9TRUNSRVRfS0VZIiwidmFsaWRhdGVDb25maWciLCJlcnJvcnMiLCJsZW5ndGgiLCJwdXNoIiwic3RhcnRzV2l0aCIsInN0ZGVyciIsIndyaXRlIiwiZm9yRWFjaCIsImVycm9yIiwiRXJyb3IiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiY29uZmlnLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGRvdGVudiA9IHJlcXVpcmUoJ2RvdGVudicpO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmNvbnN0IHsgdmFsaWRhdGVFbnZpcm9ubWVudCB9ID0gcmVxdWlyZSgnLi4vdXRpbHMvZW52VmFsaWRhdG9yJyk7XG5cbi8vIExvYWQgZW52aXJvbm1lbnQgdmFyaWFibGVzIGJhc2VkIG9uIE5PREVfRU5WXG5jb25zdCBlbnZGaWxlID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJ1xuICA/ICcuZW52LnByb2QnXG4gIDogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0J1xuICAgID8gJy5lbnYudGVzdCdcbiAgICA6ICcuZW52JztcblxuZG90ZW52LmNvbmZpZyh7IHBhdGg6IHBhdGgucmVzb2x2ZShwcm9jZXNzLmN3ZCgpLCBlbnZGaWxlKSB9KTtcblxuLy8gVmFsaWRhdGUgZW52aXJvbm1lbnQgdmFyaWFibGVzXG52YWxpZGF0ZUVudmlyb25tZW50KCk7XG5cbi8vIENvbmZpZ3VyYXRpb24gb2JqZWN0XG5jb25zdCBjb25maWcgPSB7XG4gIC8vIFNlcnZlciBjb25maWd1cmF0aW9uXG4gIHNlcnZlcjoge1xuICAgIHBvcnQ6IHBhcnNlSW50KHByb2Nlc3MuZW52LlBPUlQsIDEwKSB8fCA4MDAwLFxuICAgIGhvc3Q6IHByb2Nlc3MuZW52LkhPU1QgfHwgJzAuMC4wLjAnLFxuICAgIG5vZGVFbnY6IHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8ICdkZXZlbG9wbWVudCcsXG4gICAgaXNEZXZlbG9wbWVudDogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgfHwgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0JyxcbiAgICBpc1Byb2R1Y3Rpb246IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicsXG4gICAgaXNUZXN0OiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Rlc3QnXG4gIH0sXG5cbiAgLy8gRGF0YWJhc2UgY29uZmlndXJhdGlvblxuICBkYXRhYmFzZToge1xuICAgIHVyaTogcHJvY2Vzcy5lbnYuTU9OR09EQl9VUkksXG4gICAgb3B0aW9uczoge1xuICAgICAgbWF4UG9vbFNpemU6IHBhcnNlSW50KHByb2Nlc3MuZW52LkRCX01BWF9QT09MX1NJWkUsIDEwKSB8fCAxMCxcbiAgICAgIHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUzogcGFyc2VJbnQocHJvY2Vzcy5lbnYuREJfU0VSVkVSX1NFTEVDVElPTl9USU1FT1VULCAxMCkgfHwgNTAwMCxcbiAgICAgIHNvY2tldFRpbWVvdXRNUzogcGFyc2VJbnQocHJvY2Vzcy5lbnYuREJfU09DS0VUX1RJTUVPVVQsIDEwKSB8fCA0NTAwMFxuICAgIH1cbiAgfSxcblxuICAvLyBSZWRpcyBjb25maWd1cmF0aW9uXG4gIHJlZGlzOiB7XG4gICAgdXJsOiBwcm9jZXNzLmVudi5SRURJU19VUkwgfHwgJ3JlZGlzOi8vbG9jYWxob3N0OjYzNzknLFxuICAgIHBhc3N3b3JkOiBwcm9jZXNzLmVudi5SRURJU19QQVNTV09SRCxcbiAgICByZXRyeURlbGF5T25GYWlsb3ZlcjogMTAwLFxuICAgIG1heFJldHJpZXNQZXJSZXF1ZXN0OiAzLFxuICAgIGxhenlDb25uZWN0OiB0cnVlLFxuICAgIGtlZXBBbGl2ZTogMzAwMDAsXG4gICAgY29ubmVjdFRpbWVvdXQ6IDEwMDAwLFxuICAgIGNvbW1hbmRUaW1lb3V0OiA1MDAwXG4gIH0sXG5cbiAgLy8gSldUIGNvbmZpZ3VyYXRpb25cbiAgand0OiB7XG4gICAgc2VjcmV0OiBwcm9jZXNzLmVudi5KV1RfU0VDUkVULFxuICAgIGV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX0VYUElSRVNfSU4gfHwgJzdkJyxcbiAgICBpc3N1ZXI6IHByb2Nlc3MuZW52LkpXVF9JU1NVRVIgfHwgJ3RyaXB2YXInLFxuICAgIGF1ZGllbmNlOiBwcm9jZXNzLmVudi5KV1RfQVVESUVOQ0UgfHwgJ3RyaXB2YXItdXNlcnMnXG4gIH0sXG5cbiAgLy8gU2VjdXJpdHkgY29uZmlndXJhdGlvblxuICBzZWN1cml0eToge1xuICAgIGFsbG93ZWRPcmlnaW5zOiBwcm9jZXNzLmVudi5BTExPV0VEX09SSUdJTlNcbiAgICAgID8gcHJvY2Vzcy5lbnYuQUxMT1dFRF9PUklHSU5TLnNwbGl0KCcsJylcbiAgICAgIDogWydodHRwOi8vbG9jYWxob3N0OjUxNzMnLCAnaHR0cDovL2xvY2FsaG9zdDozMDAwJ10sXG4gICAgY29yc0NyZWRlbnRpYWxzOiBwcm9jZXNzLmVudi5DT1JTX0NSRURFTlRJQUxTID09PSAndHJ1ZScsXG4gICAgcmF0ZUxpbWl0V2luZG93TXM6IHBhcnNlSW50KHByb2Nlc3MuZW52LlJBVEVfTElNSVRfV0lORE9XX01TLCAxMCkgfHwgOTAwMDAwLCAvLyAxNSBtaW51dGVzXG4gICAgcmF0ZUxpbWl0TWF4UmVxdWVzdHM6IHBhcnNlSW50KHByb2Nlc3MuZW52LlJBVEVfTElNSVRfTUFYX1JFUVVFU1RTLCAxMCkgfHwgMTAwLFxuICAgIGF1dGhSYXRlTGltaXRNYXhSZXF1ZXN0czogcGFyc2VJbnQocHJvY2Vzcy5lbnYuQVVUSF9SQVRFX0xJTUlUX01BWF9SRVFVRVNUUywgMTApIHx8IDUsXG4gICAgYmNyeXB0Um91bmRzOiBwYXJzZUludChwcm9jZXNzLmVudi5CQ1JZUFRfUk9VTkRTLCAxMCkgfHwgMTJcbiAgfSxcblxuICAvLyBMb2dnaW5nIGNvbmZpZ3VyYXRpb25cbiAgbG9nZ2luZzoge1xuICAgIGxldmVsOiBwcm9jZXNzLmVudi5MT0dfTEVWRUwgfHwgJ2luZm8nLFxuICAgIGZpbGVQYXRoOiBwcm9jZXNzLmVudi5MT0dfRklMRV9QQVRIIHx8ICcuL2xvZ3MvYXBwLmxvZycsXG4gICAgbWF4U2l6ZTogcHJvY2Vzcy5lbnYuTE9HX01BWF9TSVpFIHx8ICcyMG0nLFxuICAgIG1heEZpbGVzOiBwYXJzZUludChwcm9jZXNzLmVudi5MT0dfTUFYX0ZJTEVTLCAxMCkgfHwgNSxcbiAgICBkYXRlUGF0dGVybjogcHJvY2Vzcy5lbnYuTE9HX0RBVEVfUEFUVEVSTiB8fCAnWVlZWS1NTS1ERCdcbiAgfSxcblxuICAvLyBTU0wvVExTIGNvbmZpZ3VyYXRpb25cbiAgc3NsOiB7XG4gICAgZW5hYmxlZDogcHJvY2Vzcy5lbnYuU1NMX0VOQUJMRUQgPT09ICd0cnVlJyxcbiAgICBjZXJ0UGF0aDogcHJvY2Vzcy5lbnYuU1NMX0NFUlRfUEFUSCxcbiAgICBrZXlQYXRoOiBwcm9jZXNzLmVudi5TU0xfS0VZX1BBVEhcbiAgfSxcblxuICAvLyBNb25pdG9yaW5nIGNvbmZpZ3VyYXRpb25cbiAgbW9uaXRvcmluZzoge1xuICAgIGhlYWx0aENoZWNrSW50ZXJ2YWw6IHBhcnNlSW50KHByb2Nlc3MuZW52LkhFQUxUSF9DSEVDS19JTlRFUlZBTCwgMTApIHx8IDMwMDAwLFxuICAgIG1ldHJpY3NFbmFibGVkOiBwcm9jZXNzLmVudi5NRVRSSUNTX0VOQUJMRUQgPT09ICd0cnVlJyxcbiAgICBzZW50cnlEc246IHByb2Nlc3MuZW52LlNFTlRSWV9EU05cbiAgfSxcblxuICAvLyBGaWxlIHVwbG9hZCBjb25maWd1cmF0aW9uXG4gIHVwbG9hZDoge1xuICAgIG1heEZpbGVTaXplOiBwYXJzZUludChwcm9jZXNzLmVudi5NQVhfRklMRV9TSVpFLCAxMCkgfHwgMTA0ODU3NjAsIC8vIDEwTUJcbiAgICB1cGxvYWRQYXRoOiBwcm9jZXNzLmVudi5VUExPQURfUEFUSCB8fCAnLi91cGxvYWRzJyxcbiAgICBhbGxvd2VkTWltZVR5cGVzOiBwcm9jZXNzLmVudi5BTExPV0VEX01JTUVfVFlQRVNcbiAgICAgID8gcHJvY2Vzcy5lbnYuQUxMT1dFRF9NSU1FX1RZUEVTLnNwbGl0KCcsJylcbiAgICAgIDogWydpbWFnZS9qcGVnJywgJ2ltYWdlL3BuZycsICdpbWFnZS9naWYnLCAnaW1hZ2Uvd2VicCddXG4gIH0sXG5cbiAgLy8gRW1haWwgY29uZmlndXJhdGlvblxuICBlbWFpbDoge1xuICAgIHNtdHBIb3N0OiBwcm9jZXNzLmVudi5TTVRQX0hPU1QsXG4gICAgc210cFBvcnQ6IHBhcnNlSW50KHByb2Nlc3MuZW52LlNNVFBfUE9SVCwgMTApIHx8IDU4NyxcbiAgICBzbXRwVXNlcjogcHJvY2Vzcy5lbnYuU01UUF9VU0VSLFxuICAgIHNtdHBQYXNzOiBwcm9jZXNzLmVudi5TTVRQX1BBU1MsXG4gICAgZnJvbUVtYWlsOiBwcm9jZXNzLmVudi5GUk9NX0VNQUlMIHx8ICdub3JlcGx5QHRyaXB2YXIuY29tJ1xuICB9LFxuXG4gIC8vIEV4dGVybmFsIEFQSXMgY29uZmlndXJhdGlvblxuICBleHRlcm5hbEFwaXM6IHtcbiAgICB0aW1lb3V0OiBwYXJzZUludChwcm9jZXNzLmVudi5FWFRFUk5BTF9BUElfVElNRU9VVCwgMTApIHx8IDEwMDAwLFxuICAgIHJldHJpZXM6IHBhcnNlSW50KHByb2Nlc3MuZW52LkVYVEVSTkFMX0FQSV9SRVRSSUVTLCAxMCkgfHwgMyxcbiAgICBnb29nbGVNYXBzQXBpS2V5OiBwcm9jZXNzLmVudi5HT09HTEVfTUFQU19BUElfS0VZLFxuICAgIHN0cmlwZVNlY3JldEtleTogcHJvY2Vzcy5lbnYuU1RSSVBFX1NFQ1JFVF9LRVlcbiAgfVxufTtcblxuLy8gVmFsaWRhdGUgY29uZmlndXJhdGlvblxuY29uc3QgdmFsaWRhdGVDb25maWcgPSAoKSA9PiB7XG4gIGNvbnN0IGVycm9ycyA9IFtdO1xuXG4gIC8vIFZhbGlkYXRlIEpXVCBzZWNyZXQgc3RyZW5ndGhcbiAgaWYgKGNvbmZpZy5qd3Quc2VjcmV0ICYmIGNvbmZpZy5qd3Quc2VjcmV0Lmxlbmd0aCA8IDMyKSB7XG4gICAgZXJyb3JzLnB1c2goJ0pXVF9TRUNSRVQgbXVzdCBiZSBhdCBsZWFzdCAzMiBjaGFyYWN0ZXJzIGxvbmcnKTtcbiAgfVxuXG4gIC8vIFZhbGlkYXRlIE1vbmdvREIgVVJJIGZvcm1hdFxuICBpZiAoIWNvbmZpZy5kYXRhYmFzZS51cmkuc3RhcnRzV2l0aCgnbW9uZ29kYjovLycpICYmICFjb25maWcuZGF0YWJhc2UudXJpLnN0YXJ0c1dpdGgoJ21vbmdvZGIrc3J2Oi8vJykpIHtcbiAgICBlcnJvcnMucHVzaCgnTU9OR09EQl9VUkkgbXVzdCBiZSBhIHZhbGlkIE1vbmdvREIgY29ubmVjdGlvbiBzdHJpbmcnKTtcbiAgfVxuXG4gIC8vIFZhbGlkYXRlIFNTTCBjb25maWd1cmF0aW9uIGluIHByb2R1Y3Rpb25cbiAgaWYgKGNvbmZpZy5zZXJ2ZXIuaXNQcm9kdWN0aW9uICYmIGNvbmZpZy5zc2wuZW5hYmxlZCkge1xuICAgIGlmICghY29uZmlnLnNzbC5jZXJ0UGF0aCB8fCAhY29uZmlnLnNzbC5rZXlQYXRoKSB7XG4gICAgICBlcnJvcnMucHVzaCgnU1NMIGNlcnRpZmljYXRlIGFuZCBrZXkgcGF0aHMgbXVzdCBiZSBwcm92aWRlZCBpbiBwcm9kdWN0aW9uJyk7XG4gICAgfVxuICB9XG5cbiAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgLy8gVXNlIHByb2Nlc3Muc3RkZXJyIGZvciBjcml0aWNhbCBzdGFydHVwIGVycm9ycyBiZWZvcmUgbG9nZ2VyIGlzIGF2YWlsYWJsZVxuICAgIHByb2Nlc3Muc3RkZXJyLndyaXRlKCdDb25maWd1cmF0aW9uIHZhbGlkYXRpb24gZXJyb3JzOlxcbicpO1xuICAgIGVycm9ycy5mb3JFYWNoKGVycm9yID0+IHByb2Nlc3Muc3RkZXJyLndyaXRlKGAtICR7ZXJyb3J9XFxuYCkpO1xuICAgIHRocm93IG5ldyBFcnJvcignQ29uZmlndXJhdGlvbiB2YWxpZGF0aW9uIGZhaWxlZCcpO1xuICB9XG59O1xuXG4vLyBSdW4gdmFsaWRhdGlvblxudmFsaWRhdGVDb25maWcoKTtcblxubW9kdWxlLmV4cG9ydHMgPSBjb25maWc7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFDaEMsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsTUFBTSxDQUFDO0FBQzVCLE1BQU07RUFBRUU7QUFBb0IsQ0FBQyxHQUFHRixPQUFPLENBQUMsdUJB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