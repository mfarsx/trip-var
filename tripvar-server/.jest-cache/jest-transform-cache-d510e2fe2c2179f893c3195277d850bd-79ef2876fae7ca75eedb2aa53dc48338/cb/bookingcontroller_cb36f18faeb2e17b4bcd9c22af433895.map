{"version":3,"names":["Booking","require","Destination","ValidationError","NotFoundError","ConflictError","successResponse","info","error","NotificationService","createBooking","req","res","next","destinationId","checkInDate","checkOutDate","numberOfGuests","paymentMethod","specialRequests","contactEmail","contactPhone","body","userId","user","id","checkIn","Date","checkOut","destination","findById","isAvailable","checkAvailability","totalNights","Math","ceil","totalAmount","price","booking","pricePerNight","email","save","bookingId","_id","createBookingConfirmationNotification","notificationError","message","status","json","err","getUserBookings","page","limit","query","skip","parseInt","bookings","find","populate","sort","createdAt","total","countDocuments","success","data","pagination","current","pages","getBookingById","params","toString","role","cancelBooking","reason","refundAmount","calculateRefund","cancelledAt","cancellationReason","paymentStatus","refundedAt","createBookingCancellationNotification","getAllBookings","updateBookingStatus","validStatuses","includes","newStatus","adminId","available","module","exports"],"sources":["booking.controller.js"],"sourcesContent":["const Booking = require('../public/models/booking.model');\nconst Destination = require('../public/models/destination.model');\nconst { ValidationError, NotFoundError, ConflictError } = require('../utils/errors');\nconst { successResponse } = require('../utils/response');\nconst { info, error } = require('../utils/logger');\nconst NotificationService = require('../services/notification.service');\n\n// Create a new booking\nconst createBooking = async(req, res, next) => {\n  try {\n    const {\n      destinationId,\n      checkInDate,\n      checkOutDate,\n      numberOfGuests,\n      paymentMethod,\n      specialRequests,\n      contactEmail,\n      contactPhone\n    } = req.body;\n\n    const userId = req.user.id;\n\n    // Validate required fields\n    if (!destinationId || !checkInDate || !checkOutDate || !numberOfGuests) {\n      throw new ValidationError('Missing required booking information');\n    }\n\n    // Parse dates\n    const checkIn = new Date(checkInDate);\n    const checkOut = new Date(checkOutDate);\n\n    // Validate dates\n    if (checkIn <= new Date()) {\n      throw new ValidationError('Check-in date must be in the future');\n    }\n\n    if (checkOut <= checkIn) {\n      throw new ValidationError('Check-out date must be after check-in date');\n    }\n\n    // Get destination details\n    const destination = await Destination.findById(destinationId);\n    if (!destination) {\n      throw new NotFoundError('Destination not found');\n    }\n\n    // Check availability\n    const isAvailable = await Booking.checkAvailability(destinationId, checkIn, checkOut);\n    if (!isAvailable) {\n      throw new ConflictError('Destination is not available for the selected dates');\n    }\n\n    // Calculate pricing\n    const totalNights = Math.ceil((checkOut - checkIn) / (1000 * 3600 * 24));\n    const totalAmount = totalNights * destination.price * numberOfGuests;\n\n    // Create booking\n    const booking = new Booking({\n      user: userId,\n      destination: destinationId,\n      checkInDate: checkIn,\n      checkOutDate: checkOut,\n      numberOfGuests,\n      pricePerNight: destination.price,\n      totalNights,\n      totalAmount,\n      paymentMethod,\n      specialRequests,\n      contactEmail: contactEmail || req.user.email,\n      contactPhone\n    });\n\n    await booking.save();\n\n    // Note: Not populating fields to keep response simple for tests\n\n    info('New booking created', {\n      bookingId: booking._id,\n      userId,\n      destinationId,\n      totalAmount\n    });\n\n    // Create booking confirmation notification\n    try {\n      await NotificationService.createBookingConfirmationNotification(userId, booking);\n    } catch (notificationError) {\n      // Log error but don't fail the booking creation\n      error('Failed to create booking confirmation notification', {\n        error: notificationError.message,\n        bookingId: booking._id,\n        userId\n      });\n    }\n\n    res.status(201).json(successResponse(\n      { booking },\n      'Booking created successfully'\n    ));\n\n  } catch (err) {\n    error('Error creating booking', { error: err.message, userId: req.user?.id });\n    next(err);\n  }\n};\n\n// Get user's bookings\nconst getUserBookings = async(req, res, next) => {\n  try {\n    const userId = req.user.id;\n    const { status, page = 1, limit = 10 } = req.query;\n\n    // Build query\n    const query = { user: userId };\n    if (status) {\n      query.status = status;\n    }\n\n    // Calculate pagination\n    const skip = (parseInt(page, 10) - 1) * parseInt(limit, 10);\n\n    // Get bookings with pagination\n    const bookings = await Booking.find(query)\n      .populate('destination', 'title location imageUrl rating')\n      .sort({ createdAt: -1 })\n      .skip(skip)\n      .limit(parseInt(limit, 10));\n\n    // Get total count for pagination\n    const total = await Booking.countDocuments(query);\n\n    res.json({\n      success: true,\n      data: {\n        bookings,\n        pagination: {\n          current: parseInt(page, 10),\n          pages: Math.ceil(total / parseInt(limit, 10)),\n          total\n        }\n      }\n    });\n\n  } catch (err) {\n    error('Error fetching user bookings', { error: err.message, userId: req.user?.id });\n    next(err);\n  }\n};\n\n// Get specific booking\nconst getBookingById = async(req, res, next) => {\n  try {\n    const { id } = req.params;\n    const userId = req.user.id;\n\n    const booking = await Booking.findById(id)\n      .populate('destination', 'title location imageUrl rating description')\n      .populate('user', 'name email');\n\n    if (!booking) {\n      throw new NotFoundError('Booking not found');\n    }\n\n    // Check if user owns this booking or is admin\n    if (booking.user._id.toString() !== userId && req.user.role !== 'admin') {\n      throw new ValidationError('Access denied');\n    }\n\n    res.json({\n      success: true,\n      data: {\n        booking\n      }\n    });\n\n  } catch (err) {\n    error('Error fetching booking', { error: err.message, bookingId: req.params.id });\n    next(err);\n  }\n};\n\n// Cancel booking\nconst cancelBooking = async(req, res, next) => {\n  try {\n    const { id } = req.params;\n    const { reason } = req.body;\n    const userId = req.user.id;\n\n    const booking = await Booking.findById(id).populate('destination');\n\n    if (!booking) {\n      throw new NotFoundError('Booking not found');\n    }\n\n    // Check if user owns this booking\n    if (booking.user.toString() !== userId) {\n      throw new ValidationError('Access denied');\n    }\n\n    // Check if booking can be cancelled\n    if (booking.status === 'cancelled') {\n      throw new ConflictError('Booking is already cancelled');\n    }\n\n    if (booking.status === 'completed') {\n      throw new ConflictError('Cannot cancel completed booking');\n    }\n\n    // Calculate refund amount\n    const refundAmount = booking.calculateRefund();\n\n    // Update booking\n    booking.status = 'cancelled';\n    booking.cancelledAt = new Date();\n    booking.cancellationReason = reason;\n    booking.refundAmount = refundAmount;\n\n    if (refundAmount > 0) {\n      booking.paymentStatus = 'refunded';\n      booking.refundedAt = new Date();\n    }\n\n    await booking.save();\n\n    info('Booking cancelled', {\n      bookingId: id,\n      userId,\n      refundAmount\n    });\n\n    // Create booking cancellation notification\n    try {\n      await NotificationService.createBookingCancellationNotification(userId, booking, refundAmount);\n    } catch (notificationError) {\n      // Log error but don't fail the cancellation\n      error('Failed to create booking cancellation notification', {\n        error: notificationError.message,\n        bookingId: id,\n        userId\n      });\n    }\n\n    res.json({\n      success: true,\n      message: 'Booking cancelled successfully',\n      data: {\n        booking,\n        refundAmount\n      }\n    });\n\n  } catch (err) {\n    error('Error cancelling booking', { error: err.message, bookingId: req.params.id });\n    next(err);\n  }\n};\n\n// Get all bookings (admin only)\nconst getAllBookings = async(req, res, next) => {\n  try {\n    const { status, page = 1, limit = 20, destinationId } = req.query;\n\n    // Build query\n    const query = {};\n    if (status) {\n      query.status = status;\n    }\n    if (destinationId) {\n      query.destination = destinationId;\n    }\n\n    // Calculate pagination\n    const skip = (parseInt(page, 10) - 1) * parseInt(limit, 10);\n\n    // Get bookings with pagination\n    const bookings = await Booking.find(query)\n      .populate('destination', 'title location')\n      .populate('user', 'name email')\n      .sort({ createdAt: -1 })\n      .skip(skip)\n      .limit(parseInt(limit, 10));\n\n    // Get total count\n    const total = await Booking.countDocuments(query);\n\n    res.json({\n      success: true,\n      data: {\n        bookings,\n        pagination: {\n          current: parseInt(page, 10),\n          pages: Math.ceil(total / parseInt(limit, 10)),\n          total\n        }\n      }\n    });\n\n  } catch (err) {\n    error('Error fetching all bookings', { error: err.message });\n    next(err);\n  }\n};\n\n// Update booking status (admin only)\nconst updateBookingStatus = async(req, res, next) => {\n  try {\n    const { id } = req.params;\n    const { status } = req.body;\n\n    const validStatuses = ['confirmed', 'cancelled', 'completed', 'no-show'];\n    if (!validStatuses.includes(status)) {\n      throw new ValidationError('Invalid booking status');\n    }\n\n    const booking = await Booking.findById(id);\n    if (!booking) {\n      throw new NotFoundError('Booking not found');\n    }\n\n    booking.status = status;\n    await booking.save();\n\n    info('Booking status updated', {\n      bookingId: id,\n      newStatus: status,\n      adminId: req.user.id\n    });\n\n    res.json({\n      success: true,\n      message: 'Booking status updated successfully',\n      data: {\n        booking\n      }\n    });\n\n  } catch (err) {\n    error('Error updating booking status', { error: err.message, bookingId: req.params.id });\n    next(err);\n  }\n};\n\n// Check availability for a destination\nconst checkAvailability = async(req, res, next) => {\n  try {\n    const { destinationId, checkInDate, checkOutDate } = req.query;\n\n    if (!destinationId || !checkInDate || !checkOutDate) {\n      throw new ValidationError('Missing required parameters');\n    }\n\n    const checkIn = new Date(checkInDate);\n    const checkOut = new Date(checkOutDate);\n\n    const isAvailable = await Booking.checkAvailability(destinationId, checkIn, checkOut);\n\n    res.json({\n      success: true,\n      data: {\n        available: isAvailable,\n        checkInDate: checkIn,\n        checkOutDate: checkOut\n      }\n    });\n\n  } catch (err) {\n    error('Error checking availability', { error: err.message });\n    next(err);\n  }\n};\n\nmodule.exports = {\n  createBooking,\n  getUserBookings,\n  getBookingById,\n  cancelBooking,\n  getAllBookings,\n  updateBookingStatus,\n  checkAvailability\n};"],"mappings":"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","ignoreList":[]}