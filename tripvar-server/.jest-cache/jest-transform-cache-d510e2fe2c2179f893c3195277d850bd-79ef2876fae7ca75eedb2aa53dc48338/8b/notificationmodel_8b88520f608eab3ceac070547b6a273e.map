{"version":3,"names":["mongoose","require","notificationSchema","Schema","user","type","Types","ObjectId","ref","required","booking","destination","title","String","trim","maxlength","message","enum","values","priority","default","isRead","Boolean","readAt","Date","actionUrl","actionText","expiresAt","timestamps","toJSON","virtuals","toObject","index","createdAt","expireAfterSeconds","virtual","get","now","created","diffTime","Math","abs","diffMinutes","floor","diffHours","diffDays","toLocaleDateString","statics","createNotification","notificationData","notification","save","markAsRead","userId","notificationIds","updateData","length","updateMany","_id","$in","getUnreadCount","countDocuments","cleanupExpired","deleteMany","$lt","Notification","model","module","exports"],"sources":["notification.model.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nconst notificationSchema = new mongoose.Schema(\n  {\n    // User who will receive the notification\n    user: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: [true, 'Notification must belong to a user']\n    },\n\n    // Related entities (optional)\n    booking: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Booking',\n      required: false\n    },\n\n    destination: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Destination',\n      required: false\n    },\n\n    // Notification content\n    title: {\n      type: String,\n      required: [true, 'Notification title is required'],\n      trim: true,\n      maxlength: [100, 'Title cannot exceed 100 characters']\n    },\n\n    message: {\n      type: String,\n      required: [true, 'Notification message is required'],\n      trim: true,\n      maxlength: [500, 'Message cannot exceed 500 characters']\n    },\n\n    // Notification type\n    type: {\n      type: String,\n      required: [true, 'Notification type is required'],\n      enum: {\n        values: [\n          'booking_confirmed',\n          'booking_cancelled',\n          'booking_reminder',\n          'payment_success',\n          'payment_failed',\n          'review_request',\n          'destination_update',\n          'promotion',\n          'system'\n        ],\n        message: 'Invalid notification type'\n      }\n    },\n\n    // Notification priority\n    priority: {\n      type: String,\n      enum: {\n        values: ['low', 'medium', 'high', 'urgent'],\n        message: 'Priority must be low, medium, high, or urgent'\n      },\n      default: 'medium'\n    },\n\n    // Read status\n    isRead: {\n      type: Boolean,\n      default: false\n    },\n\n    // Read timestamp\n    readAt: {\n      type: Date,\n      required: false\n    },\n\n    // Action URL (optional)\n    actionUrl: {\n      type: String,\n      required: false,\n      maxlength: [200, 'Action URL cannot exceed 200 characters']\n    },\n\n    // Action text (optional)\n    actionText: {\n      type: String,\n      required: false,\n      maxlength: [50, 'Action text cannot exceed 50 characters']\n    },\n\n    // Expiration date (optional)\n    expiresAt: {\n      type: Date,\n      required: false\n    }\n  },\n  {\n    timestamps: true,\n    toJSON: { virtuals: true },\n    toObject: { virtuals: true }\n  }\n);\n\n// Index for better query performance\nnotificationSchema.index({ user: 1, createdAt: -1 });\nnotificationSchema.index({ user: 1, isRead: 1 });\nnotificationSchema.index({ type: 1 });\nnotificationSchema.index({ expiresAt: 1 }, { expireAfterSeconds: 0 }); // TTL index\n\n// Virtual field for notification age\nnotificationSchema.virtual('age').get(function() {\n  const now = new Date();\n  const created = new Date(this.createdAt);\n  const diffTime = Math.abs(now - created);\n  const diffMinutes = Math.floor(diffTime / (1000 * 60));\n  const diffHours = Math.floor(diffTime / (1000 * 60 * 60));\n  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\n\n  if (diffMinutes < 1) {\n    return 'Just now';\n  }\n  if (diffMinutes < 60) {\n    return `${diffMinutes}m ago`;\n  }\n  if (diffHours < 24) {\n    return `${diffHours}h ago`;\n  }\n  if (diffDays < 7) {\n    return `${diffDays}d ago`;\n  }\n  return created.toLocaleDateString();\n});\n\n// Static method to create notification\nnotificationSchema.statics.createNotification = async function(notificationData) {\n  const notification = new this(notificationData);\n  await notification.save();\n  return notification;\n};\n\n// Static method to mark notifications as read\nnotificationSchema.statics.markAsRead = async function(userId, notificationIds) {\n  const updateData = {\n    isRead: true,\n    readAt: new Date()\n  };\n\n  if (notificationIds && notificationIds.length > 0) {\n    return await this.updateMany(\n      { _id: { $in: notificationIds }, user: userId },\n      updateData\n    );\n  } else {\n    return await this.updateMany(\n      { user: userId, isRead: false },\n      updateData\n    );\n  }\n};\n\n// Static method to get unread count\nnotificationSchema.statics.getUnreadCount = async function(userId) {\n  return await this.countDocuments({ user: userId, isRead: false });\n};\n\n// Static method to cleanup expired notifications\nnotificationSchema.statics.cleanupExpired = async function() {\n  return await this.deleteMany({\n    expiresAt: { $lt: new Date() }\n  });\n};\n\nconst Notification = mongoose.model('Notification', notificationSchema);\n\nmodule.exports = Notification;"],"mappings":"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","ignoreList":[]}