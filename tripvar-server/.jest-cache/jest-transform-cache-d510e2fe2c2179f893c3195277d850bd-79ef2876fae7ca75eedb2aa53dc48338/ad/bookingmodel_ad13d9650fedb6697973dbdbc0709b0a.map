{"version":3,"names":["mongoose","require","bookingSchema","Schema","user","type","Types","ObjectId","ref","required","destination","checkInDate","Date","validate","validator","v","message","checkOutDate","numberOfGuests","Number","min","max","pricePerNight","totalNights","totalAmount","paymentMethod","String","enum","values","paymentStatus","default","paymentIntentId","status","specialRequests","maxlength","contactEmail","lowercase","trim","test","contactPhone","cancelledAt","cancellationReason","refundAmount","refundedAt","timestamps","toJSON","virtuals","toObject","virtual","get","timeDiff","getTime","Math","ceil","_id","toString","slice","toUpperCase","pre","next","index","createdAt","statics","checkAvailability","destinationId","existingBookings","find","$in","$or","$lt","$gt","length","methods","calculateRefund","now","daysUntilCheckIn","Booking","model","module","exports"],"sources":["booking.model.js"],"sourcesContent":["const mongoose = require('mongoose');\n\nconst bookingSchema = new mongoose.Schema(\n  {\n    // User who made the booking\n    user: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: [true, 'Booking must belong to a user']\n    },\n\n    // Destination being booked\n    destination: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Destination',\n      required: [true, 'Booking must be for a destination']\n    },\n\n    // Booking dates\n    checkInDate: {\n      type: Date,\n      required: [true, 'Check-in date is required'],\n      validate: {\n        validator: function(v) {\n          // Check-in date must be in the future\n          return v > new Date();\n        },\n        message: 'Check-in date must be in the future'\n      }\n    },\n\n    checkOutDate: {\n      type: Date,\n      required: [true, 'Check-out date is required'],\n      validate: {\n        validator: function(v) {\n          // Check-out date must be after check-in date\n          return v > this.checkInDate;\n        },\n        message: 'Check-out date must be after check-in date'\n      }\n    },\n\n    // Number of guests\n    numberOfGuests: {\n      type: Number,\n      required: [true, 'Number of guests is required'],\n      min: [1, 'At least 1 guest is required'],\n      max: [10, 'Maximum 10 guests allowed']\n    },\n\n    // Pricing information\n    pricePerNight: {\n      type: Number,\n      required: [true, 'Price per night is required'],\n      min: [0, 'Price cannot be negative']\n    },\n\n    totalNights: {\n      type: Number,\n      required: true,\n      min: [1, 'At least 1 night is required']\n    },\n\n    totalAmount: {\n      type: Number,\n      required: [true, 'Total amount is required'],\n      min: [0, 'Total amount cannot be negative']\n    },\n\n    // Payment information\n    paymentMethod: {\n      type: String,\n      required: [true, 'Payment method is required'],\n      enum: {\n        values: ['credit-card', 'paypal', 'bank-transfer'],\n        message: 'Payment method must be credit-card, paypal, or bank-transfer'\n      }\n    },\n\n    paymentStatus: {\n      type: String,\n      required: true,\n      enum: {\n        values: ['pending', 'paid', 'failed', 'refunded'],\n        message: 'Payment status must be pending, paid, failed, or refunded'\n      },\n      default: 'pending'\n    },\n\n    paymentIntentId: {\n      type: String,\n      required: false // Will be set when payment is processed\n    },\n\n    // Booking status\n    status: {\n      type: String,\n      required: true,\n      enum: {\n        values: ['confirmed', 'cancelled', 'completed', 'no-show'],\n        message: 'Status must be confirmed, cancelled, completed, or no-show'\n      },\n      default: 'confirmed'\n    },\n\n    // Additional information\n    specialRequests: {\n      type: String,\n      maxlength: [500, 'Special requests cannot exceed 500 characters'],\n      required: false\n    },\n\n    // Contact information for the booking\n    contactEmail: {\n      type: String,\n      required: [true, 'Contact email is required'],\n      lowercase: true,\n      trim: true,\n      validate: {\n        validator: function(v) {\n          return /^\\w+([.-]?\\w+)*@\\w+([.-]?\\w+)*(\\.\\w{2,3})+$/.test(v);\n        },\n        message: 'Please provide a valid email address'\n      }\n    },\n\n    contactPhone: {\n      type: String,\n      required: false,\n      trim: true\n    },\n\n    // Cancellation information\n    cancelledAt: {\n      type: Date,\n      required: false\n    },\n\n    cancellationReason: {\n      type: String,\n      required: false,\n      maxlength: [200, 'Cancellation reason cannot exceed 200 characters']\n    },\n\n    // Refund information\n    refundAmount: {\n      type: Number,\n      required: false,\n      min: [0, 'Refund amount cannot be negative']\n    },\n\n    refundedAt: {\n      type: Date,\n      required: false\n    }\n  },\n  {\n    timestamps: true,\n    toJSON: { virtuals: true },\n    toObject: { virtuals: true }\n  }\n);\n\n// Virtual field for booking duration in days\nbookingSchema.virtual('duration').get(function() {\n  if (this.checkInDate && this.checkOutDate) {\n    const timeDiff = this.checkOutDate.getTime() - this.checkInDate.getTime();\n    return Math.ceil(timeDiff / (1000 * 3600 * 24));\n  }\n  return 0;\n});\n\n// Virtual field for booking reference number\nbookingSchema.virtual('bookingReference').get(function() {\n  return `TRV-${this._id.toString().slice(-8).toUpperCase()}`;\n});\n\n// Pre-save middleware to calculate total nights and amount\nbookingSchema.pre('save', function(next) {\n  if (this.checkInDate && this.checkOutDate && this.pricePerNight) {\n    const timeDiff = this.checkOutDate.getTime() - this.checkInDate.getTime();\n    this.totalNights = Math.ceil(timeDiff / (1000 * 3600 * 24));\n    this.totalAmount = this.totalNights * this.pricePerNight * this.numberOfGuests;\n  }\n  next();\n});\n\n// Index for better query performance\nbookingSchema.index({ user: 1, createdAt: -1 });\nbookingSchema.index({ destination: 1, checkInDate: 1, checkOutDate: 1 });\nbookingSchema.index({ status: 1 });\nbookingSchema.index({ paymentStatus: 1 });\n\n// Static method to check availability\nbookingSchema.statics.checkAvailability = async function(destinationId, checkInDate, checkOutDate) {\n  const existingBookings = await this.find({\n    destination: destinationId,\n    status: { $in: ['confirmed', 'completed'] },\n    $or: [\n      {\n        checkInDate: { $lt: checkOutDate },\n        checkOutDate: { $gt: checkInDate }\n      }\n    ]\n  });\n\n  return existingBookings.length === 0;\n};\n\n// Instance method to calculate refund amount\nbookingSchema.methods.calculateRefund = function() {\n  if (this.status !== 'cancelled') {\n    return 0;\n  }\n\n  const now = new Date();\n  const daysUntilCheckIn = Math.ceil((this.checkInDate - now) / (1000 * 3600 * 24));\n\n  // Refund policy: 100% if cancelled 7+ days before, 50% if 3-6 days, 0% if less than 3 days\n  if (daysUntilCheckIn >= 7) {\n    return this.totalAmount;\n  } else if (daysUntilCheckIn >= 3) {\n    return this.totalAmount * 0.5;\n  } else {\n    return 0;\n  }\n};\n\nconst Booking = mongoose.model('Booking', bookingSchema);\n\nmodule.exports = Booking;"],"mappings":"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","ignoreList":[]}